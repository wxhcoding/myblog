<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/myblog/assets/img/favicon.ico"><link rel="manifest" href="/myblog/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><title>JVM | Jhw-Blog</title><meta name="description" content="Jhw-Blog">
    <link rel="preload" href="/myblog/assets/style-cpavdnw8.css" as="style"><link rel="stylesheet" href="/myblog/assets/style-cpavdnw8.css">
    <link rel="modulepreload" href="/myblog/assets/app-1lTnJ-Z-.js"><link rel="modulepreload" href="/myblog/assets/jvm.html-iEXdtkqR.js"><link rel="modulepreload" href="/myblog/assets/jvm.html-EUA1LDC3.js">
    <link rel="prefetch" href="/myblog/assets/index.html-Wl1PsAI-.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-lock.html-EqBnxiPq.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-transaction.html-tL9JC4dQ.js" as="script"><link rel="prefetch" href="/myblog/assets/es6.html-ZIFOMWSy.js" as="script"><link rel="prefetch" href="/myblog/assets/headline.html-iQxNz79q.js" as="script"><link rel="prefetch" href="/myblog/assets/javaweb.html-eWdk1uNe.js" as="script"><link rel="prefetch" href="/myblog/assets/vue.html-Gu8dUKxJ.js" as="script"><link rel="prefetch" href="/myblog/assets/about.html-Mmqs-yBX.js" as="script"><link rel="prefetch" href="/myblog/assets/leetcode.html-d9qMMonP.js" as="script"><link rel="prefetch" href="/myblog/assets/project_learn.html-i6UvzIJa.js" as="script"><link rel="prefetch" href="/myblog/assets/docker.html-U-NptGUz.js" as="script"><link rel="prefetch" href="/myblog/assets/git.html-QKdD4BLW.js" as="script"><link rel="prefetch" href="/myblog/assets/kafka.html-TqyYtOJI.js" as="script"><link rel="prefetch" href="/myblog/assets/linux.html-95BIkgfo.js" as="script"><link rel="prefetch" href="/myblog/assets/maven.html-zzF1XH4C.js" as="script"><link rel="prefetch" href="/myblog/assets/node.html-7wc2oKut.js" as="script"><link rel="prefetch" href="/myblog/assets/logback.html-yhzJS4yv.js" as="script"><link rel="prefetch" href="/myblog/assets/mybatis.html-Bz52-a_8.js" as="script"><link rel="prefetch" href="/myblog/assets/java_basic.html-tP4Yo5Sj.js" as="script"><link rel="prefetch" href="/myblog/assets/juc.html-6HoHfEGd.js" as="script"><link rel="prefetch" href="/myblog/assets/spring.html-Y9UzXRue.js" as="script"><link rel="prefetch" href="/myblog/assets/springboot.html-ygPSVqH8.js" as="script"><link rel="prefetch" href="/myblog/assets/springcloud.html-Wxl5NcN3.js" as="script"><link rel="prefetch" href="/myblog/assets/spring_mvc.html-qp9D9o3C.js" as="script"><link rel="prefetch" href="/myblog/assets/ssm.html-eXce4ppB.js" as="script"><link rel="prefetch" href="/myblog/assets/elasticsearch.html-dt57WX6m.js" as="script"><link rel="prefetch" href="/myblog/assets/redis.html-Fo1p0r9s.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_basic.html-G53LLX0K.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_practice.html-TPHnUGzX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_advanced.html-M6nIRymX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_basic.html-vOaRzrU0.js" as="script"><link rel="prefetch" href="/myblog/assets/404.html-6ekMbMKm.js" as="script"><link rel="prefetch" href="/myblog/assets/index.html-qr4Og0Rr.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-lock.html-XUub3Fym.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-transaction.html-Z6y0cTF-.js" as="script"><link rel="prefetch" href="/myblog/assets/es6.html-E3eKG72j.js" as="script"><link rel="prefetch" href="/myblog/assets/headline.html-6RamNUSU.js" as="script"><link rel="prefetch" href="/myblog/assets/javaweb.html-1TeHUZPw.js" as="script"><link rel="prefetch" href="/myblog/assets/vue.html-WUpgFl2K.js" as="script"><link rel="prefetch" href="/myblog/assets/about.html-Er1rP_zQ.js" as="script"><link rel="prefetch" href="/myblog/assets/leetcode.html-hXt3DFmj.js" as="script"><link rel="prefetch" href="/myblog/assets/project_learn.html-BA3TzwH0.js" as="script"><link rel="prefetch" href="/myblog/assets/docker.html-8CsL54Kw.js" as="script"><link rel="prefetch" href="/myblog/assets/git.html-tk22OH3D.js" as="script"><link rel="prefetch" href="/myblog/assets/kafka.html-Hm-frda-.js" as="script"><link rel="prefetch" href="/myblog/assets/linux.html-XNDiQSL9.js" as="script"><link rel="prefetch" href="/myblog/assets/maven.html-EX-RejGP.js" as="script"><link rel="prefetch" href="/myblog/assets/node.html-nWfdA14A.js" as="script"><link rel="prefetch" href="/myblog/assets/logback.html-cNyE_cya.js" as="script"><link rel="prefetch" href="/myblog/assets/mybatis.html-NP16NZEg.js" as="script"><link rel="prefetch" href="/myblog/assets/java_basic.html-VrTOuTVp.js" as="script"><link rel="prefetch" href="/myblog/assets/juc.html-sGjKk3Y1.js" as="script"><link rel="prefetch" href="/myblog/assets/spring.html-Gh4CgLBM.js" as="script"><link rel="prefetch" href="/myblog/assets/springboot.html-_s9YqnAk.js" as="script"><link rel="prefetch" href="/myblog/assets/springcloud.html-aOLK_E_h.js" as="script"><link rel="prefetch" href="/myblog/assets/spring_mvc.html-Q6Xl-jwi.js" as="script"><link rel="prefetch" href="/myblog/assets/ssm.html-V0xUMA4v.js" as="script"><link rel="prefetch" href="/myblog/assets/elasticsearch.html-uFK4xAZE.js" as="script"><link rel="prefetch" href="/myblog/assets/redis.html-R9Tcqrr7.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_basic.html-jzaBuldH.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_practice.html-cnuYp868.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_advanced.html-_NwIumpX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_basic.html-pS0iCeJf.js" as="script"><link rel="prefetch" href="/myblog/assets/404.html-KeMubcAJ.js" as="script"><link rel="prefetch" href="/myblog/assets/index-7SG8bi1h.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/myblog/" class=""><img class="logo" src="/myblog/assets/img/logo.png" alt="Jhw-Blog"><span class="site-name can-hide">Jhw-Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/myblog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/java_basic/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring Framework</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring/" class="" aria-label="Spring IOC|AOP"><!--[--><!--]--> Spring IOC|AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring_mvc/" class="" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/ssm/" class="" aria-label="SSM"><!--[--><!--]--> SSM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springboot/" class="" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springcloud/" class="" aria-label="SpringCloud"><!--[--><!--]--> SpringCloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/logback/" class="" aria-label="Logback"><!--[--><!--]--> Logback <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_basic/" class="" aria-label="MySQL入门"><!--[--><!--]--> MySQL入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_advanced/" class="" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_basic/" class="" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_practice/" class="" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/elasticsearch" class="" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-lock/" class="" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-transaction/" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/tools/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/maven/" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/fronted/javaweb/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/es6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/headline/" class="" aria-label="微头条"><!--[--><!--]--> 微头条 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="杂记"><span class="title">杂记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="杂记"><span class="title">杂记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/note/project_learn/" class="" aria-label="笔记"><!--[--><!--]--> 笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wxhcoding/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/myblog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/java_basic/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring Framework</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring/" class="" aria-label="Spring IOC|AOP"><!--[--><!--]--> Spring IOC|AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring_mvc/" class="" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/ssm/" class="" aria-label="SSM"><!--[--><!--]--> SSM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springboot/" class="" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springcloud/" class="" aria-label="SpringCloud"><!--[--><!--]--> SpringCloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/logback/" class="" aria-label="Logback"><!--[--><!--]--> Logback <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_basic/" class="" aria-label="MySQL入门"><!--[--><!--]--> MySQL入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_advanced/" class="" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_basic/" class="" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_practice/" class="" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/elasticsearch" class="" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-lock/" class="" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-transaction/" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/tools/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/maven/" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/fronted/javaweb/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/es6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/headline/" class="" aria-label="微头条"><!--[--><!--]--> 微头条 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="杂记"><span class="title">杂记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="杂记"><span class="title">杂记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/note/project_learn/" class="" aria-label="笔记"><!--[--><!--]--> 笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wxhcoding/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/myblog/backend/java/java_basic.html" class="sidebar-item sidebar-heading" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/backend/java/jvm.html#快速入门" class="router-link-active router-link-exact-active sidebar-item" aria-label="快速入门"><!--[--><!--]--> 快速入门 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/backend/java/jvm.html#类加载器class-loader" class="router-link-active router-link-exact-active sidebar-item" aria-label="类加载器Class Loader"><!--[--><!--]--> 类加载器Class Loader <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#其他模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="其他模块"><!--[--><!--]--> 其他模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#栈stack" class="router-link-active router-link-exact-active sidebar-item" aria-label="栈Stack"><!--[--><!--]--> 栈Stack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#堆heap" class="router-link-active router-link-exact-active sidebar-item" aria-label="堆Heap"><!--[--><!--]--> 堆Heap <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#gc垃圾回收" class="router-link-active router-link-exact-active sidebar-item" aria-label="GC垃圾回收"><!--[--><!--]--> GC垃圾回收 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/backend/java/jvm.html#垃圾判定" class="router-link-active router-link-exact-active sidebar-item" aria-label="垃圾判定"><!--[--><!--]--> 垃圾判定 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/backend/java/jvm.html#引用计数法" class="router-link-active router-link-exact-active sidebar-item" aria-label="引用计数法"><!--[--><!--]--> 引用计数法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#可达性分析算法" class="router-link-active router-link-exact-active sidebar-item" aria-label="可达性分析算法"><!--[--><!--]--> 可达性分析算法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#四种引用" class="router-link-active router-link-exact-active sidebar-item" aria-label="四种引用"><!--[--><!--]--> 四种引用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#垃圾回收算法" class="router-link-active router-link-exact-active sidebar-item" aria-label="垃圾回收算法"><!--[--><!--]--> 垃圾回收算法 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/backend/java/jvm.html#复制算法-copying" class="router-link-active router-link-exact-active sidebar-item" aria-label="复制算法(Copying)"><!--[--><!--]--> 复制算法(Copying) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#标记清除-mark-sweep" class="router-link-active router-link-exact-active sidebar-item" aria-label="标记清除(Mark-Sweep)"><!--[--><!--]--> 标记清除(Mark-Sweep) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#标记压缩-mark-compact" class="router-link-active router-link-exact-active sidebar-item" aria-label="标记压缩(Mark-Compact)"><!--[--><!--]--> 标记压缩(Mark-Compact) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/backend/java/jvm.html#分代收集算法-generational-collection" class="router-link-active router-link-exact-active sidebar-item" aria-label="分代收集算法(Generational-Collection)"><!--[--><!--]--> 分代收集算法(Generational-Collection) <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a href="/myblog/backend/java/juc.html" class="sidebar-item sidebar-heading" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/spring/spring.html" class="sidebar-item sidebar-heading" aria-label="Spring IOC|AOP"><!--[--><!--]--> Spring IOC|AOP <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/spring/spring_mvc.html" class="sidebar-item sidebar-heading" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/spring/ssm.html" class="sidebar-item sidebar-heading" aria-label="SSM整合"><!--[--><!--]--> SSM整合 <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/spring/springboot.html" class="sidebar-item sidebar-heading" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/spring/springcloud.html" class="sidebar-item sidebar-heading" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/framework/mybatis.html" class="sidebar-item sidebar-heading" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a><!----></li><li><a href="/myblog/backend/framework/logback.html" class="sidebar-item sidebar-heading" aria-label="Logback"><!--[--><!--]--> Logback <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="jvm" tabindex="-1"><a class="header-anchor" href="#jvm" aria-hidden="true">#</a> JVM</h1><blockquote><p><strong>JVM</strong>是运行在操作系统之上的，它与硬件没有直接的交互</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/wxhcoding/myblog-img/java/jvm-20231027183756.png" alt="jvm-20231027183756"></p><h2 id="快速入门" tabindex="-1"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h2><ul><li>方法区: 存储已被虚拟机加载的类元数据信息(元空间)</li><li><strong>堆</strong>: 存放对象实例，几乎所有的对象实例都在这里分配内存</li><li>虚拟机栈: 虚拟机栈描述的是Java方法执行的内存模型: 每个方法被执行的时候都会同时创建一个栈帧(Stack Frame) 用于存储局部变量表、操作栈、动态链接、方法出口等信息</li><li>程序计数器: 当前线程所执行的字节码的行号指示器</li><li>本地方法栈: 本地方法栈则是为虚拟机使用到的Native方法服务</li></ul><hr><h3 id="类加载器class-loader" tabindex="-1"><a class="header-anchor" href="#类加载器class-loader" aria-hidden="true">#</a> 类加载器Class Loader</h3><p>负责加载class文件，class文件在文件开头有特定的文件标示，并且ClassLoader<strong>只负责class文件的加载</strong>，至于是否可以运行是由Execution Engine决定</p><div class="custom-container tip"><p class="custom-container-title">分类</p></div><p>类加载器分为四种：前三种为虚拟机自带的加载器:</p><ul><li>启动类加载器（Bootstrap）C++<br> 负责加载$JAVA_HOME中jre/lib/<strong>rt.jar</strong>里所有的class，由C++实现，不是ClassLoader子类</li><li>扩展类加载器（Extension）Java<br> 负责加载java平台中<strong>扩展功能</strong>的一些jar包，包括$JAVA_HOME中jre/lib/*.jar或-Djava.ext.dirs指定目录下的jar包</li><li>应用程序类加载器（AppClassLoader）Java<br> 也叫系统类加载器，负责加载<strong>classpath</strong>中指定的jar包及目录中class</li><li>用户自定义加载器 Java.lang.ClassLoader的子类，用户可以定制类的加载方式</li></ul><div class="custom-container tip"><p class="custom-container-title">工作流程</p></div><ol><li>当AppClassLoader加载一个class时，它首先不会自己去尝试加载这个类，而是把类加载请求委派给父类加载器ExtClassLoader去完成</li><li>当ExtClassLoader加载一个class时，它首先也不会自己去尝试加载这个类，而是把类加载请求委派给BootStrapClassLoader去完成</li><li>如果BootStrapClassLoader加载失败（例如在$JAVA_HOME/jre/lib里未查找到该class），会使用ExtClassLoader来尝试加载</li><li>若ExtClassLoader也加载失败，则会使用AppClassLoader来加载</li><li>如果AppClassLoader也加载失败，则会报出异常ClassNotFoundException</li></ol><p>其实这就是所谓的<strong>双亲委派模型</strong>。<br> 简单来说：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把<strong>请求委托给父加载器去完成，依次向上</strong>。</p><p>好处：<strong>防止内存中出现多份同样的字节码</strong>(安全性角度)<br> 比如加载位于 rt.jar 包中的类 java.lang.Object，不管是哪个加载器加载这个类，最终都是委托给顶层的启动类加载器进行加载，这样就保证了使用不同的类加载器最终得到的都是同样一个 Object对象</p><h3 id="其他模块" tabindex="-1"><a class="header-anchor" href="#其他模块" aria-hidden="true">#</a> 其他模块</h3><div class="custom-container tip"><p class="custom-container-title">执行引擎Execution Engine</p></div><p><strong>Execution Engine</strong>执行引擎负责解释命令，提交操作系统执行。</p><div class="custom-container tip"><p class="custom-container-title">本地接口Native Interface</p></div><p>本地接口的作用是融合不同的编程语言为 Java 所用，它的初衷是融合 C/C++程序，Java 诞生的时候是 C/C++横行的时候，要想立足，必须有调用 C/C++程序，于是就在内存中专门开辟了一块区域处理标记为native的代码，它的具体做法是 Native Method Stack中登记 native方法，在Execution Engine 执行时加载native libraies。<br> 目前该方法使用的越来越少了，除非是与硬件有关的应用，比如通过Java程序驱动打印机或者Java系统管理生产设备，在企业级应用中已经比较少见。因为现在的异构领域间的通信很发达，比如可以使用 Socket通信，也可以使用Web Service等等，不多做介绍</p><div class="custom-container tip"><p class="custom-container-title">本地方法栈Native Method Stack</p></div><p>它的具体做法是Native Method Stack中登记native方法，在Execution Engine 执行时加载本地方法库</p><div class="custom-container tip"><p class="custom-container-title">PC寄存器</p></div><p>每个线程都有一个程序计数器，是<strong>线程私有的</strong>，就是一个指针，指向方法区中的方法字节码（<strong>用来存储指向下一条指令的地址</strong>，即将要执行的指令代码），由执行引擎读取下一条指令，是一个非常小的内存空间，几乎可以忽略不记。</p><div class="custom-container tip"><p class="custom-container-title">Method Area方法区</p></div><p>方法区是被所有线程共享，所有字段和方法字节码，以及一些特殊方法如构造函数，接口代码也在此定义。简单说，所有定义的方法的信息都保存在该区域，<strong>此区属于共享区间</strong>。</p><p><strong>静态变量+常量+类信息(构造方法/接口定义)+运行时常量池</strong>存在方法区中</p><p>但是<br><strong>实例变量存在堆内存</strong>中,和方法区无关</p><h3 id="栈stack" tabindex="-1"><a class="header-anchor" href="#栈stack" aria-hidden="true">#</a> 栈Stack</h3><blockquote><p>栈也叫栈内存，<strong>主管Java程序的运行，是在线程创建时创建</strong>，它的生命期是跟随线程的生命期，线程结束栈内存也就释放，<strong>对于栈来说不存在垃圾回收问题</strong>，只要线程一结束该栈就Over，生命周期和线程一致，是线程私有的。<strong>8种基本类型的变量+对象的引用变量+实例方法</strong>都是在函数的栈内存中分配</p></blockquote><p><strong>栈存储什么?</strong></p><p>栈中的数据都是以<strong>栈帧</strong>（Stack Frame）的格式存在，栈帧是一个内存区块，是一个数据集，是一个有关方法(Method)和运行期数据的数据集。</p><p>栈帧中主要保存3 类数据：</p><ul><li>本地变量（Local Variables）：输入参数和输出参数以及方法内的变量。</li><li>栈操作（Operand Stack）：记录出栈、入栈的操作。</li><li>栈帧数据（Frame Data）：包括类文件、方法等等。</li></ul><p>遵循<strong>先进后出</strong>或者<strong>后进先出</strong>原则</p><p><strong>常见问题栈溢出</strong>：<code>Exception in thread &quot;main&quot; java.lang.StackOverflowError</code> 通常出现在递归调用时。</p><h3 id="堆heap" tabindex="-1"><a class="header-anchor" href="#堆heap" aria-hidden="true">#</a> 堆Heap</h3><div class="custom-container tip"><p class="custom-container-title">体系概述</p></div><p>Java7之前</p><p>一个JVM实例只存在一个堆内存，堆内存的大小是可以调节的。类加载器读取了类文件后，需要把类、方法、常变量放到堆内存中，保存所有引用类型的真实信息，以方便执行器执行，堆内存<strong>逻辑</strong>上分为三部分(物理上永久代并不属于堆，永久代还被成为非堆)：</p><ul><li>Young Generation Space 新生区 Young/New</li><li>Tenure generation space 养老区 Old/Tenure</li><li>Permanent Space 永久区 Perm</li></ul><p>也称为：新生代（年轻代）、老年代、永久代（持久代）。</p><p><strong>注意</strong>:</p><ul><li>Jdk1.6及之前：有永久代，常量池1.6在方法区</li><li>Jdk1.7： 有永久代，但已经逐步“去永久代”，常量池1.7在堆</li><li><strong>Jdk1.8及之后： 无永久代，常量池1.8在堆中</strong></li></ul><div class="custom-container tip"><p class="custom-container-title">新生代</p></div><p>新生区是对象的<strong>诞生、成长、消亡</strong>的区域，一个对象在这里产生，应用，最后被垃圾回收器收集，结束生命。</p><p>新生区又分为两部分：</p><ul><li>伊甸区（Eden space）和幸存者区（Survivor pace） ，所有的对象都是在伊甸区被new出来的。</li><li>幸存区有两个： From区（Survivor From space）和To区（Survivor To space）。</li></ul><p>当Eden space的空间用完时，程序又需要创建对象，JVM的垃圾回收器将对Eden space进行垃圾回收(<strong>Minor GC</strong>)，将Eden space中的不再被其他对象所引用的对象进行销毁。然后将Eden space中的剩余对象移动到幸存区的From区。</p><hr><p>MinorGC垃圾回收的过程如下： <span class="badge tip" style="vertical-align:top;"><!--[-->GC流程<!--]--></span></p><ol><li>eden、From 复制到 To，年龄+1 <ul><li>首先，当Eden区满的时候会触发第一次GC,把还活着的对象拷贝到Survivor From区</li><li>当Eden区再次触发GC的时候会扫描Eden区和From区域，对这<strong>两个区域</strong>进行垃圾回收，经过这次回收后还存活的对象，则直接复制到To区域</li><li>如果有对象的年龄已经达到了老年的标准，则赋值到老年代区，同时把这些对象的年龄+1</li></ul></li><li>清空 eden、Survivor From <ul><li>清空Eden和From中的对象</li></ul></li><li>To和 From 互换 <ul><li>最后，To和From互换，原To成为下一次GC时的From区。</li><li>部分对象会在From和To区域中复制来复制去,如此交换<strong>15次</strong>(由JVM参数MaxTenuringThreshold决定,这个参数默认是15)，最终如果还是存活,就存入到老年代</li></ul></li><li>大对象特殊情况 <ul><li>如果分配的新对象比较大Eden区放不下，但Old区可以放下时，对象会被直接分配到Old区（即没有晋升这一过程，直接到老年代了）</li></ul></li></ol><p>MinorGC的过程：<strong>复制</strong> -&gt; <strong>清空</strong> -&gt; <strong>互换</strong></p><div class="custom-container tip"><p class="custom-container-title">老年代</p></div><p>这里面存放的是经历多次GC仍然存在的对象（默认是15次），所以老年代的对象比较稳定，不会频繁的GC<br> 若养老区也满了，那么这个时候将产生<strong>MajorGC（FullGC）</strong>，进行养老区的内存清理。<br> 若养老区执行了Full GC之后发现依然无法进行对象的保存，就会产生OOM异常<code>OutOfMemoryError</code></p><hr><p>如果出现<code>java.lang.OutOfMemoryError: Java heap space</code>异常,说明Java虚拟机的堆内存不够,原因如下:</p><ul><li>Java虚拟机的堆内存设置不够，可以通过参数<code>-Xms、-Xmx</code>来调整。</li><li>代码中创建了大量大对象，并且长时间不能被垃圾收集器收集（存在被引用）。</li></ul><div class="custom-container tip"><p class="custom-container-title">永久代</p></div><p>永久存储区是一个常驻内存区域，用于存放JDK自身所携带的 Class、Interface 的元数据，也就是说它存储的是运行环境必须的类信息，被装载进此区域的数据是不会被垃圾回收器回收掉的，关闭 JVM 才会释放此区域所占用的内存</p><p>很多开发者习惯将方法区称之为“永久代(Parmanent Gen)” ，但严格本质上说两者不同，或者说使用永久代来实现方法区而已，永久代是方法区(相当于是一个接口interface)的一个实现<br> 实际而言，方法区（Method Area）和堆一样，是各个线程共享的内存区域，它用于存储虚拟机加载的：类信息+普通常量+静态常量+编译器编译后的代码等等，<strong>虽然JVM规范将方法区描述为堆的一个逻辑部分，但它却还有一个别名叫做Non-Heap(非堆)，目的就是要和堆分开。</strong></p><p>如果出现<code>java.lang.OutOfMemoryError: PermGen space</code>，<strong>说明是Java虚拟机对永久代Perm内存设置不够。一般出现这种情况，都是程序启动需要加载大量的第三方jar包。例如：在一个Tomcat下部署了太多的应用。或者大量动态反射生成的类不断被加载，最终导致Perm区被占满。</strong></p><hr><p>永久代与元空间的最大区别之处：<br><strong>永久代使用的是jvm的堆内存</strong>，但是java8以后的<strong>元空间</strong>并不在虚拟机中而是<strong>使用本机物理内存</strong>。<br> 因此，默认情况下，元空间的大小仅受本地内存限制。</p><div class="custom-container tip"><p class="custom-container-title">堆参数调优入门</p></div><table><thead><tr><th>参数</th><th>备注</th></tr></thead><tbody><tr><td>-Xms</td><td>初始堆大小。只要启动，就占用的堆大小，默认是内存的1/64</td></tr><tr><td>-Xmx</td><td>最大堆大小。默认是内存的1/4</td></tr><tr><td>-Xmn</td><td>新生区堆大小</td></tr><tr><td>-XX:+PrintGCDetails</td><td>输出详细的GC处理日志</td></tr></tbody></table><p>java代码查看jvm堆的默认值大小：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 堆的最大值，默认是内存的1/4</span>
<span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 堆的当前总大小，默认是内存的1/64</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置JVM参数 <ul><li>在运行时进行配置 选择 <code>Add VM options</code></li><li>可以参考配置 <code>-Xmx50m -Xms30m -XX:+PrintGCDetails</code><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 查看堆内存详情</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;最大堆大小：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前堆大小：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==================================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li>GC演示 <ul><li>jvm参数设置成最大堆内存100M，当前堆内存10M：<code>-Xmx100m -Xms10m -XX:+PrintGCDetails</code></li><li>运行下面的代码 可以看到minor GC和full GC日志<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====================Begin=========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;最大堆大小：Xmx=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;剩余堆大小：free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前堆大小：total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==================First Allocated===================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;5MB array allocated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;剩余堆大小：free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前堆大小：total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================Second Allocated===================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;10MB array allocated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;剩余堆大小：free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前堆大小：total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====================OOM=========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;OOM!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">40</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li>OOM演示 <ul><li>把上面案例中的jvm参数改成最大堆内存设置成50M，当前堆内存设置成10M，执行测试：<code>-Xmx50m -Xms10m -XX:+PrintGCDetails</code><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token separator comment">=====================</span>Begin<span class="token separator comment">=========================</span>
剩余堆大小：free mem<span class="token operator">=</span><span class="token number">8.186859130859375M</span>
当前堆大小：total mem<span class="token operator">=</span><span class="token number">9.5M</span>
<span class="token separator comment">=================</span>First Allocated<span class="token separator comment">=====================</span>
<span class="token number">5MB</span> array allocated
剩余堆大小：free mem<span class="token operator">=</span><span class="token number">3.1868438720703125M</span>
当前堆大小：total mem<span class="token operator">=</span><span class="token number">9.5M</span>
<span class="token separator comment">================</span>Second Allocated<span class="token separator comment">====================</span>
<span class="token number">10MB</span> array allocated
剩余堆大小：free mem<span class="token operator">=</span><span class="token number">3.68682861328125M</span>
当前堆大小：total mem<span class="token operator">=</span><span class="token number">20.0M</span>
<span class="token separator comment">=====================</span>OOM<span class="token separator comment">=========================</span>
OOM<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
Exception in thread <span class="token string">&quot;main&quot;</span> <span class="token exception javastacktrace language-javastacktrace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>OutOfMemoryError<span class="token punctuation">:</span> Java heap space
    <span class="token keyword">at</span> com<span class="token punctuation">.</span>atcode<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>HeapDemo<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>HeapDemo<span class="token punctuation">.</span>java<span class="token punctuation">:</span>40<span class="token punctuation">)</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><div class="custom-container tip"><p class="custom-container-title">定位问题工具</p></div><ul><li><a href="https://eclipse.dev/mat/downloads.php" target="_blank" rel="noopener noreferrer">MAT工具<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><ul><li>这个工具是eclipse中的一个插件 现在已经分离出来 可以从官网进行下载</li></ul></li><li>使用jdk自带的<a href="(https://visualvm.github.io/index.html)">jvisualvm.exe</a>进行分析(jdk1.8的版本在bin目录下即可找到 而后续的版本需要单独下载) <ul><li>更改运行前参数: <code>-Xmx50m -Xms10m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=D:\tmp</code></li><li><code>-XX:+HeapDumpOnOutOfMemoryError</code> 在发生OOM时生成dump文件</li><li><code>-XX:HeapDumpPath=D:\tmp</code>: 生成dump文件路径</li><li>然后使用jvisualvm.exe进行上述生成文件的装入分析</li></ul></li></ul><h2 id="gc垃圾回收" tabindex="-1"><a class="header-anchor" href="#gc垃圾回收" aria-hidden="true">#</a> GC垃圾回收</h2><p>JVM垃圾判定算法：（对象已死?）</p><ul><li>引用计数法(Reference-Counting)</li><li>可达性分析算法（根搜索算法）</li></ul><p>GC垃圾回收主要有四大算法：（怎么找到已死对象并清除?）</p><ul><li>复制算法(Copying)</li><li>标记清除(Mark-Sweep)</li><li>标记压缩(Mark-Compact)，又称标记整理</li><li>分代收集算法(Generational-Collection)</li></ul><hr><h3 id="垃圾判定" tabindex="-1"><a class="header-anchor" href="#垃圾判定" aria-hidden="true">#</a> 垃圾判定</h3><h4 id="引用计数法" tabindex="-1"><a class="header-anchor" href="#引用计数法" aria-hidden="true">#</a> 引用计数法</h4><blockquote><p>引用计数算法是通过判断对象的<strong>引用数量</strong>来决定对象是否可以被回收。</p></blockquote><p>给对象中添加一个引用计数器，每当有一个地方引用它时，计数器值就加1；当引用失效时，计数器值就减1；任何时刻计数器为0的对象就是不可能再被使用的。</p><ul><li><p>优点：</p><ul><li>简单，高效，现在的objective-c、python等用的就是这种算法。</li></ul></li><li><p>缺点：</p><ul><li>引用和去引用伴随着加减算法，影响性能</li><li>很难处理循环引用，相互引用的两个对象则无法释放。</li></ul></li></ul><p><strong>因此目前主流的Java虚拟机都摒弃掉了这种算法</strong>。</p><h4 id="可达性分析算法" tabindex="-1"><a class="header-anchor" href="#可达性分析算法" aria-hidden="true">#</a> 可达性分析算法</h4><p>这个算法的基本思想就是通过一系列的称为 <strong>“GC Roots”</strong> 的对象作为起点，从这些节点开始向下搜索，节点所走过的路径称为引用链，当一个对象到 GC Roots 没有任何引用链相连的话，则证明此对象是不可用的。</p><p>在Java语言中，可以作为GC Roots的对象包括下面几种：</p><ul><li>虚拟机栈（栈帧中的本地变量表）中的引用对象。</li><li>方法区中的类静态属性引用的对象。</li><li>方法区中的常量引用的对象。</li><li>本地方法栈中JNI（Native方法）的引用对象。</li></ul><p><strong>真正标记以为对象为可回收状态至少要标记两次</strong>:</p><ul><li>第一次标记：不在 GC Roots 链中，标记为可回收对象。</li><li>第二次标记：判断当前对象是否实现了finalize() 方法，如果没有实现则直接判定这个对象可以回收，如果实现了就会先放入一个队列中。并由虚拟机建立一个低优先级的程序去执行它，随后就会进行第二次小规模标记，在这次被标记的对象就会真正被回收了</li></ul><h4 id="四种引用" tabindex="-1"><a class="header-anchor" href="#四种引用" aria-hidden="true">#</a> 四种引用</h4><p>平时只会用到强引用和软引用。</p><ul><li><strong>强引用</strong><br> 类似于 Object obj = new Object(); 只要强引用还存在，垃圾收集器永远不会回收掉被引用的对象。</li><li><strong>软引用</strong><br> SoftReference 类实现软引用。在系统要发生内存溢出异常之前，才会将这些对象列进回收范围之中进行二次回收。如果这次回收还没有足够的内存，才会抛出内存溢出异常。软引用可用来实现内存敏感的高速缓存。</li><li>弱引用<br> WeakReference 类实现弱引用。对象只能生存到下一次垃圾收集之前。在垃圾收集器工作时，无论内存是否足够都会回收掉只被弱引用关联的对象。</li><li>虚引用<br> PhantomReference 类实现虚引用。无法通过虚引用获取一个对象的实例，为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知</li></ul><h3 id="垃圾回收算法" tabindex="-1"><a class="header-anchor" href="#垃圾回收算法" aria-hidden="true">#</a> 垃圾回收算法</h3><blockquote><p>在介绍JVM垃圾回收算法前，先介绍一个概念：<strong>Stop-the-World</strong><br> Stop-the-world意味着 JVM由于要执行GC而停止了应用程序的执行，并且这种情形会在任何一种GC算法中发生。当Stop-the-world发生时，除了GC所需的线程以外，所有线程都处于等待状态直到GC任务完成。<br> 事实上，<strong>GC优化很多时候就是指减少Stop-the-world发生的时间，从而使系统具有高吞吐 、低停顿的特点。</strong></p></blockquote><h4 id="复制算法-copying" tabindex="-1"><a class="header-anchor" href="#复制算法-copying" aria-hidden="true">#</a> 复制算法(Copying)</h4><div class="custom-container tip"><p class="custom-container-title">介绍</p></div><p>该算法将内存平均分成两部分，然后每次只使用其中的一部分，当这部分内存满的时候，将内存中所有存活的对象复制到另一个内存中，然后将之前的内存清空，只使用这部分内存，循环下去。</p><p>优点：</p><ul><li>实现简单</li><li>不产生内存碎片</li></ul><p>缺点：</p><ul><li>将内存缩小为原来的一半，浪费了一半的内存空间，代价太高；如果不想浪费一半的空间，就需要有额外的空间进行分配担保，以应对被使用的内存中所有对象都100%存活的极端情况，所以在老年代一般不能直接选用这种算法。</li><li>如果对象的存活率很高，我们可以极端一点，假设是100%存活，那么我们需要将所有对象都复制一遍，并将所有引用地址重置一遍。复制这一工作所花费的时间，在对象存活率达到一定程度时，将会变的不可忽视。 所以从以上描述不难看出，复制算法要想使用，最起码对象的存活率要非常低才行，而且最重要的是，我们必须要克服50%内存的浪费。</li></ul><p><strong>年轻代中使用的是Minor GC，这种GC算法采用的是复制算法(Copying)。</strong></p><p>HotSpot JVM把年轻代分为了三部分：1个Eden区和2个Survivor区（分别叫from和to）。默认比例为8:1:1,一般情况下，新创建的对象都会被分配到Eden区。因为年轻代中的对象基本都是朝生夕死的(90%以上)，所以在年轻代的垃圾回收算法使用的是复制算法。</p><div class="custom-container tip"><p class="custom-container-title">流程</p></div><p>在GC开始的时候，对象只会存在于Eden区和名为“From”的Survivor区，Survivor区“To”是空的。紧接着进行GC，Eden区中所有存活的对象都会被复制到“To”，而在“From”区中，仍存活的对象会根据他们的年龄值来决定去向。</p><p>对象在Survivor区中每熬过一次Minor GC，年龄就会增加1岁。年龄达到一定值(年龄阈值，可以通过-XX:MaxTenuringThreshold来设置)的对象会被移动到年老代中，没有达到阈值的对象会被复制到“To”区域。</p><p>经过这次GC后，Eden区和From区已经被清空。这个时候，“From”和“To”会交换他们的角色，也就是新的“To”就是上次GC前的“From”，新的“From”就是上次GC前的“To”。</p><p>不管怎样，都会保证名为To的Survivor区域是空的。Minor GC会一直重复这样的过程，直到“To”区被填满，“To”区被填满之后，会将所有对象移动到年老代中。</p><p>因为Eden区对象一般存活率较低，一般的，使用两块10%的内存作为空闲和活动区间，而另外80%的内存，则是用来给新建对象分配内存的。一旦发生GC，将10%的from活动区间与另外80%中存活的eden对象转移到10%的to空闲区间，接下来，将之前90%的内存全部释放，以此类推。</p><h4 id="标记清除-mark-sweep" tabindex="-1"><a class="header-anchor" href="#标记清除-mark-sweep" aria-hidden="true">#</a> 标记清除(Mark-Sweep)</h4><p>“标记-清除”(Mark Sweep)算法是几种GC算法中最基础的算法，是因为后续的收集算法都是基于这种思路并对其不足进行改进而得到的。</p><p>正如名字一样，算法分为2个阶段：</p><ol><li>标记出需要回收的对象，使用的标记算法均为<strong>可达性分析算法</strong>。</li><li>回收被标记的对象。</li></ol><p>缺点：</p><ul><li>效率问题（两次遍历）</li><li>空间问题（标记清除后会产生大量不连续的碎片。JVM就不得不维持一个内存的空闲列表，这又是一种开销。而且在分配数组对象的时候，寻找连续的内存空间会不太好找。）</li></ul><h4 id="标记压缩-mark-compact" tabindex="-1"><a class="header-anchor" href="#标记压缩-mark-compact" aria-hidden="true">#</a> 标记压缩(Mark-Compact)</h4><p>标记-整理法是标记-清除法的一个改进版。同样，在标记阶段，该算法也将所有对象标记为存活和死亡两种状态；<br> 不同的是，在第二个阶段，该算法并没有直接对死亡的对象进行清理，而是通过<strong>所有存活对像都向一端移动，然后直接清除边界以外的内存。</strong></p><p>优点：</p><ul><li>标记/整理算法不仅可以弥补标记/清除算法当中，内存区域分散的缺点，也消除了复制算法当中，内存减半的高额代价。</li></ul><p>缺点：</p><ul><li>如果存活的对象过多，整理阶段将会执行较多复制操作，导致算法效率降低。</li></ul><p><strong>老年代一般是由标记清除或者是标记清除与标记整理的混合实现。</strong></p><h4 id="分代收集算法-generational-collection" tabindex="-1"><a class="header-anchor" href="#分代收集算法-generational-collection" aria-hidden="true">#</a> 分代收集算法(Generational-Collection)</h4><ul><li>内存效率：复制算法&gt;标记清除算法&gt;标记整理算法（此处的效率只是简单的对比时间复杂度，实际情况不一定如此）</li><li>内存整齐度：复制算法=标记整理算法&gt;标记清除算法</li><li>内存利用率：标记整理算法=标记清除算法&gt;复制算法</li></ul><p>可以看出，效率上来说，复制算法是当之无愧的老大，但是却浪费了太多内存，而为了尽量兼顾上面所提到的三个指标，标记/整理算法相对来说更平滑一些，但效率上依然不尽如人意，它比复制算法多了一个标记的阶段，又比标记/清除多了一个整理内存的过程</p><hr><p>难道就没有一种最优算法吗？<br> 回答：无，没有最好的算法，只有最合适的算法。==========&gt;<strong>分代收集算法</strong>。</p><p>分代回收算法实际上是把复制算法和标记整理法的结合，并不是真正一个新的算法，一般分为：老年代（Old Generation）和新生代（Young Generation），老年代就是很少垃圾需要进行回收的，新生代就是有很多的内存空间需要回收，所以不同代就采用不同的回收算法，以此来达到高效的回收算法。</p><p><strong>年轻代(Young Gen)</strong></p><ul><li><strong>年轻代特点是区域相对老年代较小，对像存活率低。</strong></li><li>这种情况复制算法的回收整理，速度是最快的。复制算法的效率只和当前存活对像大小有关，因而很适用于年轻代的回收。而复制算法内存利用率不高的问题，通过hotspot中的两个survivor的设计得到缓解。</li></ul><p><strong>老年代(Tenure Gen)</strong></p><ul><li><strong>老年代的特点是区域较大，对像存活率高。</strong></li><li>这种情况，存在大量存活率高的对像，复制算法明显变得不合适。一般是由标记清除或者是标记清除与标记整理的混合实现。</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1515398578@qq.com">wxhcoding</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/myblog/backend/java/java_basic.html" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></span><span class="next"><a href="/myblog/backend/java/juc.html" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/myblog/assets/app-1lTnJ-Z-.js" defer></script>
  </body>
</html>
