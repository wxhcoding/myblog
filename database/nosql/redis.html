<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/myblog/assets/img/favicon.ico"><link rel="manifest" href="/myblog/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><title>Redis | Jhw-Blog</title><meta name="description" content="Jhw-Blog">
    <link rel="preload" href="/myblog/assets/style-cpavdnw8.css" as="style"><link rel="stylesheet" href="/myblog/assets/style-cpavdnw8.css">
    <link rel="modulepreload" href="/myblog/assets/app-1lTnJ-Z-.js"><link rel="modulepreload" href="/myblog/assets/redis.html-Fo1p0r9s.js"><link rel="modulepreload" href="/myblog/assets/redis.html-R9Tcqrr7.js">
    <link rel="prefetch" href="/myblog/assets/index.html-Wl1PsAI-.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-lock.html-EqBnxiPq.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-transaction.html-tL9JC4dQ.js" as="script"><link rel="prefetch" href="/myblog/assets/es6.html-ZIFOMWSy.js" as="script"><link rel="prefetch" href="/myblog/assets/headline.html-iQxNz79q.js" as="script"><link rel="prefetch" href="/myblog/assets/javaweb.html-eWdk1uNe.js" as="script"><link rel="prefetch" href="/myblog/assets/vue.html-Gu8dUKxJ.js" as="script"><link rel="prefetch" href="/myblog/assets/about.html-Mmqs-yBX.js" as="script"><link rel="prefetch" href="/myblog/assets/leetcode.html-d9qMMonP.js" as="script"><link rel="prefetch" href="/myblog/assets/project_learn.html-i6UvzIJa.js" as="script"><link rel="prefetch" href="/myblog/assets/docker.html-U-NptGUz.js" as="script"><link rel="prefetch" href="/myblog/assets/git.html-QKdD4BLW.js" as="script"><link rel="prefetch" href="/myblog/assets/kafka.html-TqyYtOJI.js" as="script"><link rel="prefetch" href="/myblog/assets/linux.html-95BIkgfo.js" as="script"><link rel="prefetch" href="/myblog/assets/maven.html-zzF1XH4C.js" as="script"><link rel="prefetch" href="/myblog/assets/node.html-7wc2oKut.js" as="script"><link rel="prefetch" href="/myblog/assets/logback.html-yhzJS4yv.js" as="script"><link rel="prefetch" href="/myblog/assets/mybatis.html-Bz52-a_8.js" as="script"><link rel="prefetch" href="/myblog/assets/java_basic.html-tP4Yo5Sj.js" as="script"><link rel="prefetch" href="/myblog/assets/juc.html-6HoHfEGd.js" as="script"><link rel="prefetch" href="/myblog/assets/jvm.html-iEXdtkqR.js" as="script"><link rel="prefetch" href="/myblog/assets/spring.html-Y9UzXRue.js" as="script"><link rel="prefetch" href="/myblog/assets/springboot.html-ygPSVqH8.js" as="script"><link rel="prefetch" href="/myblog/assets/springcloud.html-Wxl5NcN3.js" as="script"><link rel="prefetch" href="/myblog/assets/spring_mvc.html-qp9D9o3C.js" as="script"><link rel="prefetch" href="/myblog/assets/ssm.html-eXce4ppB.js" as="script"><link rel="prefetch" href="/myblog/assets/elasticsearch.html-dt57WX6m.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_basic.html-G53LLX0K.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_practice.html-TPHnUGzX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_advanced.html-M6nIRymX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_basic.html-vOaRzrU0.js" as="script"><link rel="prefetch" href="/myblog/assets/404.html-6ekMbMKm.js" as="script"><link rel="prefetch" href="/myblog/assets/index.html-qr4Og0Rr.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-lock.html-XUub3Fym.js" as="script"><link rel="prefetch" href="/myblog/assets/distributed-transaction.html-Z6y0cTF-.js" as="script"><link rel="prefetch" href="/myblog/assets/es6.html-E3eKG72j.js" as="script"><link rel="prefetch" href="/myblog/assets/headline.html-6RamNUSU.js" as="script"><link rel="prefetch" href="/myblog/assets/javaweb.html-1TeHUZPw.js" as="script"><link rel="prefetch" href="/myblog/assets/vue.html-WUpgFl2K.js" as="script"><link rel="prefetch" href="/myblog/assets/about.html-Er1rP_zQ.js" as="script"><link rel="prefetch" href="/myblog/assets/leetcode.html-hXt3DFmj.js" as="script"><link rel="prefetch" href="/myblog/assets/project_learn.html-BA3TzwH0.js" as="script"><link rel="prefetch" href="/myblog/assets/docker.html-8CsL54Kw.js" as="script"><link rel="prefetch" href="/myblog/assets/git.html-tk22OH3D.js" as="script"><link rel="prefetch" href="/myblog/assets/kafka.html-Hm-frda-.js" as="script"><link rel="prefetch" href="/myblog/assets/linux.html-XNDiQSL9.js" as="script"><link rel="prefetch" href="/myblog/assets/maven.html-EX-RejGP.js" as="script"><link rel="prefetch" href="/myblog/assets/node.html-nWfdA14A.js" as="script"><link rel="prefetch" href="/myblog/assets/logback.html-cNyE_cya.js" as="script"><link rel="prefetch" href="/myblog/assets/mybatis.html-NP16NZEg.js" as="script"><link rel="prefetch" href="/myblog/assets/java_basic.html-VrTOuTVp.js" as="script"><link rel="prefetch" href="/myblog/assets/juc.html-sGjKk3Y1.js" as="script"><link rel="prefetch" href="/myblog/assets/jvm.html-EUA1LDC3.js" as="script"><link rel="prefetch" href="/myblog/assets/spring.html-Gh4CgLBM.js" as="script"><link rel="prefetch" href="/myblog/assets/springboot.html-_s9YqnAk.js" as="script"><link rel="prefetch" href="/myblog/assets/springcloud.html-aOLK_E_h.js" as="script"><link rel="prefetch" href="/myblog/assets/spring_mvc.html-Q6Xl-jwi.js" as="script"><link rel="prefetch" href="/myblog/assets/ssm.html-V0xUMA4v.js" as="script"><link rel="prefetch" href="/myblog/assets/elasticsearch.html-uFK4xAZE.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_basic.html-jzaBuldH.js" as="script"><link rel="prefetch" href="/myblog/assets/redis_practice.html-cnuYp868.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_advanced.html-_NwIumpX.js" as="script"><link rel="prefetch" href="/myblog/assets/mysql_basic.html-pS0iCeJf.js" as="script"><link rel="prefetch" href="/myblog/assets/404.html-KeMubcAJ.js" as="script"><link rel="prefetch" href="/myblog/assets/index-7SG8bi1h.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/myblog/" class=""><img class="logo" src="/myblog/assets/img/logo.png" alt="Jhw-Blog"><span class="site-name can-hide">Jhw-Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/myblog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/java_basic/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring Framework</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring/" class="" aria-label="Spring IOC|AOP"><!--[--><!--]--> Spring IOC|AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring_mvc/" class="" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/ssm/" class="" aria-label="SSM"><!--[--><!--]--> SSM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springboot/" class="" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springcloud/" class="" aria-label="SpringCloud"><!--[--><!--]--> SpringCloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/logback/" class="" aria-label="Logback"><!--[--><!--]--> Logback <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_basic/" class="" aria-label="MySQL入门"><!--[--><!--]--> MySQL入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_advanced/" class="" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_basic/" class="" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_practice/" class="" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/elasticsearch" class="" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-lock/" class="" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-transaction/" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/tools/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/maven/" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/fronted/javaweb/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/es6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/headline/" class="" aria-label="微头条"><!--[--><!--]--> 微头条 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="杂记"><span class="title">杂记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="杂记"><span class="title">杂记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/note/project_learn/" class="" aria-label="笔记"><!--[--><!--]--> 笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wxhcoding/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/myblog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/java_basic/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/java/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring Framework</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring/" class="" aria-label="Spring IOC|AOP"><!--[--><!--]--> Spring IOC|AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/spring_mvc/" class="" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/ssm/" class="" aria-label="SSM"><!--[--><!--]--> SSM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springboot/" class="" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/spring/springcloud/" class="" aria-label="SpringCloud"><!--[--><!--]--> SpringCloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/backend/framework/logback/" class="" aria-label="Logback"><!--[--><!--]--> Logback <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_basic/" class="" aria-label="MySQL入门"><!--[--><!--]--> MySQL入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/sql/mysql_advanced/" class="" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_basic/" class="" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/redis_practice/" class="" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/myblog/database/nosql/elasticsearch" class="" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-lock/" class="" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/distributed/distributed-transaction/" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/tools/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/maven/" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/tools/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/fronted/javaweb/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/es6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/fronted/headline/" class="" aria-label="微头条"><!--[--><!--]--> 微头条 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="杂记"><span class="title">杂记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="杂记"><span class="title">杂记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/myblog/note/project_learn/" class="" aria-label="笔记"><!--[--><!--]--> 笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/myblog/note/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wxhcoding/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/myblog/database/sql/mysql_basic.html" class="sidebar-item sidebar-heading" aria-label="MySQL入门"><!--[--><!--]--> MySQL入门 <!--[--><!--]--></a><!----></li><li><a href="/myblog/database/sql/mysql_advanced.html" class="sidebar-item sidebar-heading" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#常用数据类型及命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="常用数据类型及命令"><!--[--><!--]--> 常用数据类型及命令 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#字符串-string" class="router-link-active router-link-exact-active sidebar-item" aria-label="字符串(String)"><!--[--><!--]--> 字符串(String) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#列表-list" class="router-link-active router-link-exact-active sidebar-item" aria-label="列表(List)"><!--[--><!--]--> 列表(List) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#集合-set" class="router-link-active router-link-exact-active sidebar-item" aria-label="集合(Set)"><!--[--><!--]--> 集合(Set) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#哈希-hash" class="router-link-active router-link-exact-active sidebar-item" aria-label="哈希(Hash)"><!--[--><!--]--> 哈希(Hash) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#有序集合-zset" class="router-link-active router-link-exact-active sidebar-item" aria-label="有序集合(Zset)"><!--[--><!--]--> 有序集合(Zset) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#key操作的相关命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="key操作的相关命令"><!--[--><!--]--> key操作的相关命令 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#jedis客户端" class="router-link-active router-link-exact-active sidebar-item" aria-label="Jedis客户端"><!--[--><!--]--> Jedis客户端 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#springboot整合redis" class="router-link-active router-link-exact-active sidebar-item" aria-label="SpringBoot整合Redis"><!--[--><!--]--> SpringBoot整合Redis <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#事务锁机制" class="router-link-active router-link-exact-active sidebar-item" aria-label="事务锁机制"><!--[--><!--]--> 事务锁机制 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#事务锁案例" class="router-link-active router-link-exact-active sidebar-item" aria-label="事务锁案例"><!--[--><!--]--> 事务锁案例 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#悲观锁" class="router-link-active router-link-exact-active sidebar-item" aria-label="悲观锁"><!--[--><!--]--> 悲观锁 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#乐观锁" class="router-link-active router-link-exact-active sidebar-item" aria-label="乐观锁"><!--[--><!--]--> 乐观锁 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#redis实现监视key" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redis实现监视key"><!--[--><!--]--> Redis实现监视key <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#三个特性" class="router-link-active router-link-exact-active sidebar-item" aria-label="三个特性"><!--[--><!--]--> 三个特性 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#lua脚本" class="router-link-active router-link-exact-active sidebar-item" aria-label="Lua脚本"><!--[--><!--]--> Lua脚本 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#redis的持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redis的持久化"><!--[--><!--]--> Redis的持久化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#rdb持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="RDB持久化"><!--[--><!--]--> RDB持久化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#rdb相关的配置与操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="RDB相关的配置与操作"><!--[--><!--]--> RDB相关的配置与操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#rdb持久化流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="RDB持久化流程"><!--[--><!--]--> RDB持久化流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#rdb的优势和劣势" class="router-link-active router-link-exact-active sidebar-item" aria-label="RDB的优势和劣势"><!--[--><!--]--> RDB的优势和劣势 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#aof持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOF持久化"><!--[--><!--]--> AOF持久化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#aof相关配置与操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOF相关配置与操作"><!--[--><!--]--> AOF相关配置与操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#aof持久化流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOF持久化流程"><!--[--><!--]--> AOF持久化流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#aof的优势和劣势" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOF的优势和劣势"><!--[--><!--]--> AOF的优势和劣势 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#rdb和aof" class="router-link-active router-link-exact-active sidebar-item" aria-label="RDB和AOF"><!--[--><!--]--> RDB和AOF <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#redis主从复制" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redis主从复制"><!--[--><!--]--> Redis主从复制 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#具体操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="具体操作"><!--[--><!--]--> 具体操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#主从复制原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="主从复制原理"><!--[--><!--]--> 主从复制原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#主从复制三种模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="主从复制三种模式"><!--[--><!--]--> 主从复制三种模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#哨兵模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="哨兵模式"><!--[--><!--]--> 哨兵模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#redis集群" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redis集群"><!--[--><!--]--> Redis集群 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/myblog/database/nosql/redis.html#集群的搭建" class="router-link-active router-link-exact-active sidebar-item" aria-label="集群的搭建"><!--[--><!--]--> 集群的搭建 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#集群的操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="集群的操作"><!--[--><!--]--> 集群的操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/myblog/database/nosql/redis.html#集群的利弊" class="router-link-active router-link-exact-active sidebar-item" aria-label="集群的利弊"><!--[--><!--]--> 集群的利弊 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/myblog/database/nosql/redis_basic.html" class="sidebar-item sidebar-heading" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a><!----></li><li><a href="/myblog/database/nosql/redis_practice.html" class="sidebar-item sidebar-heading" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a><!----></li><li><a href="/myblog/database/nosql/elasticsearch.html" class="sidebar-item sidebar-heading" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h1><h2 id="常用数据类型及命令" tabindex="-1"><a class="header-anchor" href="#常用数据类型及命令" aria-hidden="true">#</a> 常用数据类型及命令</h2><h3 id="字符串-string" tabindex="-1"><a class="header-anchor" href="#字符串-string" aria-hidden="true">#</a> 字符串(String)</h3><table><thead><tr><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>set &lt;key&gt;&lt;value&gt;</td><td>添加键值对</td></tr><tr><td></td><td>NX：当数据库中key不存在时，可以将key-value添加数据库</td></tr><tr><td></td><td>XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</td></tr><tr><td></td><td>EX：key的超时秒数</td></tr><tr><td></td><td>PX：key的超时毫秒数，与EX互斥</td></tr><tr><td>get &lt;key&gt;</td><td>查询对应键值</td></tr><tr><td>append &lt;key&gt;&lt;value&gt;</td><td>将给定的&lt;value&gt; 追加到原值的末尾</td></tr><tr><td>strlen &lt;key&gt;</td><td>获得值的长度</td></tr><tr><td>setnx &lt;key&gt;&lt;value&gt;</td><td>只有在 key 不存在时 设置 key 的值</td></tr><tr><td>incr &lt;key&gt;</td><td>将 key 中储存的数字值增1,只能对数字值操作，如果为空，新增值为1</td></tr><tr><td>decr &lt;key&gt;</td><td>将 key 中储存的数字值减1,只能对数字值操作，如果为空，新增值为-1</td></tr><tr><td>incrby / decrby &lt;key&gt;&lt;步长&gt;</td><td>将 key 中储存的数字值增减。自定义步长</td></tr><tr><td>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; .....</td><td>同时设置一个或多个 key-value对</td></tr><tr><td>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt; .....</td><td>同时获取一个或多个 value</td></tr><tr><td>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; .....</td><td>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。有一个失败则都失败(原子性)</td></tr><tr><td>getrange &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;</td><td>获得值的范围，类似java中的substring，<strong>前包，后包</strong></td></tr><tr><td>setrange &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;</td><td>用 &lt;value&gt; 覆写&lt;key&gt;所储存的字符串值，从&lt;起始位置&gt;开始(<strong>索引从0</strong>开始)。</td></tr><tr><td>setex &lt;key&gt; &lt;过期时间&gt; &lt;value&gt;</td><td>设置键值的同时，设置过期时间，单位秒。</td></tr><tr><td>getset &lt;key&gt;&lt;value&gt;</td><td>以新换旧，设置了新值同时获得旧值。</td></tr></tbody></table><h3 id="列表-list" tabindex="-1"><a class="header-anchor" href="#列表-list" aria-hidden="true">#</a> 列表(List)</h3><blockquote><p>单键多值, 一个键下的value是一个List.Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。它的底层实际是个双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p></blockquote><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; ....</td><td>从左边/右边插入一个或多个值。</td></tr><tr><td>lpop/rpop &lt;key&gt;</td><td>从左边/右边吐出一个值。值在键在，值光键亡。</td></tr><tr><td>rpoplpush &lt;key1&gt;&lt;key2&gt;</td><td>从&lt;key1&gt;列表右边吐出一个值，插到&lt;key2&gt;列表左边</td></tr><tr><td>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</td><td>按照索引下标获得元素(从左到右)</td></tr><tr><td></td><td>0左边第一个，-1右边第一个，（0, -1表示获取所有）</td></tr><tr><td>lindex &lt;key&gt;&lt;index&gt;</td><td>按照索引下标获得元素(从左到右)</td></tr><tr><td>llen &lt;key&gt;</td><td>获得列表长度</td></tr><tr><td>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;</td><td>在&lt;value&gt;的前面插入&lt;newvalue&gt;插入值</td></tr><tr><td>linsert &lt;key&gt; after &lt;value&gt;&lt;newvalue&gt;</td><td>在&lt;value&gt;的后面插入&lt;newvalue&gt;插入值</td></tr><tr><td>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;</td><td>从左边删除n个相同的value(从左到右)</td></tr><tr><td>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;</td><td>将列表key下标为index的值替换成value</td></tr></tbody></table><h3 id="集合-set" tabindex="-1"><a class="header-anchor" href="#集合-set" aria-hidden="true">#</a> 集合(Set)</h3><blockquote><p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以<strong>自动排重</strong>的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。<br> Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的<strong>复杂度都是O(1)</strong>。一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p></blockquote><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; .....</td><td>将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</td></tr><tr><td>smembers &lt;key&gt;</td><td>取出该集合的所有值。</td></tr><tr><td>sismember &lt;key&gt;&lt;value&gt;</td><td>判断集合&lt;key&gt;是否为含有该&lt;value&gt;值，有1，没有0</td></tr><tr><td>scard&lt;key&gt;</td><td>返回该集合的元素个数。</td></tr><tr><td>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ....</td><td>删除集合中的某个元素。</td></tr><tr><td>spop &lt;key&gt;</td><td>随机从该集合中吐出一个值</td></tr><tr><td>spop &lt;key&gt;&lt;N&gt;</td><td>随机从该集合中吐出N个值。</td></tr><tr><td>srandmember &lt;key&gt;&lt;n&gt;</td><td>随机从该集合中取出n个值。不会从集合中删除 。</td></tr><tr><td>smove &lt;source&gt;&lt;destination&gt;&lt;value&gt;</td><td>把集合中一个值从一个集合移动到另一个集合</td></tr><tr><td>sinter &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的交集元素。</td></tr><tr><td>sunion &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的并集元素。</td></tr><tr><td>sdiff &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的<strong>差集</strong>元素(key1中的，不包含key2中的)</td></tr></tbody></table><h3 id="哈希-hash" tabindex="-1"><a class="header-anchor" href="#哈希-hash" aria-hidden="true">#</a> 哈希(Hash)</h3><blockquote><p>Redis hash 是一个键值对集合。Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。类似Java里面的Map&lt;String,Object&gt;用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息<br><strong>通过 key(用户ID) + field(属性标签) 就可以操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题</strong></p></blockquote><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;</td><td>给&lt;key&gt;集合中的 &lt;field&gt;键赋值&lt;value&gt;</td></tr><tr><td>hget &lt;key1&gt;&lt;field&gt;</td><td>从&lt;key1&gt;集合&lt;field&gt;取出 value</td></tr><tr><td>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;...</td><td>批量设置hash的值</td></tr><tr><td>hexists&lt;key1&gt;&lt;field&gt;</td><td>查看哈希表 key 中，给定域 field 是否存在。</td></tr><tr><td>hkeys &lt;key&gt;</td><td>列出该hash集合的所有field</td></tr><tr><td>hvals &lt;key&gt;</td><td>列出该hash集合的所有value</td></tr><tr><td>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;</td><td>为哈希表 key 中的域 field 的值加上增量 1 -1</td></tr><tr><td>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;</td><td>将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 .</td></tr></tbody></table><h3 id="有序集合-zset" tabindex="-1"><a class="header-anchor" href="#有序集合-zset" aria-hidden="true">#</a> 有序集合(Zset)</h3><blockquote><p>Redis有序集合zset与普通集合set非常相似，是一个没有重复元素的字符串集合。不同之处是有序集合的每个成员都关联了一个评分（score）,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了 。因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p></blockquote><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…</td><td>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</td></tr><tr><td>zrange&lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</td><td>升序返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素,0代表第一个元素索引,-1代表最后一个元素索引.带WITHSCORES，可以让分数一起和值返回到结果集。</td></tr><tr><td>zrevrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</td><td>降序返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素,0代表第一个元素索引,-1代表最后一个元素索引.带WITHSCORES，可以让分数一起和值返回到结果集</td></tr><tr><td>zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [withscores] [limit offset count]</td><td>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。</td></tr><tr><td>zrevrangebyscore &lt;key&gt; &lt;max&gt; &lt;min&gt; [withscores] [limit offset count]</td><td>同上，改为从大到小排列。</td></tr><tr><td>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;</td><td>为元素的score加上增量</td></tr><tr><td>zrem &lt;key&gt;&lt;value&gt;</td><td>删除该集合下，指定值的元素</td></tr><tr><td>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;</td><td>统计该集合，分数区间内的元素个数</td></tr><tr><td>zrank &lt;key&gt;&lt;value&gt;</td><td>返回该值在集合中的排名，从0开始。</td></tr></tbody></table><h3 id="key操作的相关命令" tabindex="-1"><a class="header-anchor" href="#key操作的相关命令" aria-hidden="true">#</a> key操作的相关命令</h3><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>keys *</td><td>查看当前库所有key</td></tr><tr><td>exists key</td><td>判断某个key是否存在</td></tr><tr><td>type key</td><td>查看你的key是什么类型</td></tr><tr><td>del key</td><td>删除指定的key数据</td></tr><tr><td>unlink key</td><td>非阻塞删除,仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作</td></tr><tr><td>expire key 10</td><td>10秒钟：为给定的key设置过期时间</td></tr><tr><td>ttl key</td><td>查看还有多少秒过期，-1表示永不过期，-2表示已过期</td></tr><tr><td>select</td><td>命令切换数据库</td></tr><tr><td>dbsize</td><td>查看当前数据库的key的数量</td></tr><tr><td>flushdb</td><td>清空当前库</td></tr><tr><td>flushall</td><td>清空全部库</td></tr></tbody></table><h2 id="jedis客户端" tabindex="-1"><a class="header-anchor" href="#jedis客户端" aria-hidden="true">#</a> Jedis客户端</h2><p>使用Jedis几乎和我们上面练习的命令都一致<br> 首先我们创建一个Maven项目并导入相关的依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--导入Jedis的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后下面进行测试，这里只测试了String和Key相关的一些API</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisRedis</span> <span class="token punctuation">{</span>

    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 传入我们的ip 和 redis的端口号</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.206.100&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 测试是否连接成功</span>
        <span class="token class-name">String</span> pong <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;pong = &quot;</span> <span class="token operator">+</span> pong<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 最后关闭连接</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.206.100&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterEach</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 测试 set get 语法</span>
        <span class="token class-name">String</span> result1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result1 = &quot;</span> <span class="token operator">+</span> result1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result1 = OK</span>
        <span class="token class-name">String</span> name1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;name1 = &quot;</span> <span class="token operator">+</span> name1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//name1 = tom1</span>

        <span class="token comment">// 测试 mset mget 方法</span>
        <span class="token class-name">String</span> result2 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">&quot;name2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result2 = &quot;</span> <span class="token operator">+</span> result2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result2 = OK</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;name2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;list2 = &quot;</span> <span class="token operator">+</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//list2 = [tom2, tom3]</span>

        <span class="token comment">// 在value后面追加</span>
        <span class="token class-name">Long</span> append <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;addcontext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;append = &quot;</span> <span class="token operator">+</span> append<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//append = 10</span>
        <span class="token comment">// 输出长度</span>
        <span class="token class-name">Long</span> length <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;length = &quot;</span> <span class="token operator">+</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//length = 10</span>

        <span class="token comment">// 只有key不存在才可以添加</span>
        <span class="token comment">// key存在添加失败</span>
        <span class="token class-name">Long</span> result3 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result3 = &quot;</span> <span class="token operator">+</span> result3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result3 = 0 =&gt; 失败</span>
        <span class="token comment">// key不存在才添加成功</span>
        <span class="token class-name">Long</span> result4 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result4 = &quot;</span> <span class="token operator">+</span> result4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result4 = 1 =&gt; 成功</span>
        <span class="token comment">// key存在就修改</span>
        <span class="token class-name">String</span> result5 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tomupdate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result5 = &quot;</span> <span class="token operator">+</span> result5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result5 = OK</span>

        <span class="token comment">// 增加</span>
        <span class="token class-name">Long</span> age1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">incrBy</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;age1 = &quot;</span> <span class="token operator">+</span> age1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//age1 = 20</span>
        <span class="token comment">// 减少</span>
        <span class="token class-name">Long</span> age2 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">decrBy</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;age2 = &quot;</span> <span class="token operator">+</span> age2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//age2 = 18</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获取所有的key</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;keys = &quot;</span> <span class="token operator">+</span> keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//keys = [name, name3, name2, name1, age]</span>

        <span class="token comment">// 给key设置过期时间</span>
        <span class="token class-name">String</span> result1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;test expire time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result1 = &quot;</span> <span class="token operator">+</span> result1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result1 = OK</span>
        <span class="token comment">// 获取过期时间</span>
        <span class="token class-name">Long</span> time <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;time = &quot;</span> <span class="token operator">+</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//time = 3 =&gt; 单位秒</span>

        <span class="token comment">// 判断key是否存在 输出存在几个</span>
        <span class="token class-name">Long</span> exists <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;exists = &quot;</span> <span class="token operator">+</span> exists<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//exists = 2 =&gt; 存在两个key</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springboot整合redis" tabindex="-1"><a class="header-anchor" href="#springboot整合redis" aria-hidden="true">#</a> SpringBoot整合Redis</h2><p>创建一个Maven工程并导入相关的依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--首先导入父工程--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!--导入相关依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--导入web的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引入spring-test的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--导入springboot整合redis的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写配置文件<code>application.properties</code></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.data.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.206.100</span>
<span class="token key attr-name">spring.data.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token comment"># springboot中默认的redis客户端为 lettuce 并配置redis的host以及端口号</span>
<span class="token comment"># 默认开启连接池</span>
<span class="token key attr-name">spring.data.redis.client-type</span><span class="token punctuation">=</span><span class="token value attr-value">lettuce</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个启动类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span> <span class="token comment">// SpringBoot的启动类</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>改变序列化的机制</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// 配置类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppRedisConfiguration</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 允许Object类型的key-value，都可以被转为json进行存储。
     * <span class="token keyword">@param</span> <span class="token parameter">redisConnectionFactory</span> 自动配置好了连接工厂
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// RedisTemplate 对底层进行了封装 底层无论使用lettuce还是jedis 都对他们的方法进行封装</span>
        <span class="token comment">// 使用 opsForValue 等方法进行调用 无论使用哪个工具统一了使用方法</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//把对象转为json字符串的序列化工具</span>
        template<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写测试类进行测试</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTest</span> <span class="token punctuation">{</span> <span class="token comment">// 我们的测试类的包要和上面的启动类属于包的同一层级 即都在 com.atcode.redis 下</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> k1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;k1 = &quot;</span> <span class="token operator">+</span> k1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span> keys <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;keys = &quot;</span> <span class="token operator">+</span> keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Long</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPushAll</span><span class="token punctuation">(</span><span class="token string">&quot;listKey&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result = &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string">&quot;listKey&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面演示更改默认的Lettuce，使用Jedis连接Redis</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--首先导入父工程--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!--导入相关依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--导入web的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引入spring-test的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--导入springboot整合redis的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--如果要用Jedis 首先排除自带的lettuce--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.lettuce<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lettuce-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--然后导入Jedis--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写配置文件<code>application.properties</code></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.data.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.206.100</span>
<span class="token key attr-name">spring.data.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token comment"># springboot中默认的redis客户端为 lettuce 配置redis的host以及端口号</span>
<span class="token comment"># 默认开启连接池</span>
<span class="token comment">#spring.data.redis.client-type=lettuce</span>

<span class="token comment"># 我们也可以更改默认的客户端 改为Jedis</span>
<span class="token key attr-name">spring.data.redis.client-type</span><span class="token punctuation">=</span><span class="token value attr-value">jedis</span>
<span class="token key attr-name">spring.data.redis.jedis.pool.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">spring.data.redis.jedis.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进行测试</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTest</span> <span class="token punctuation">{</span> <span class="token comment">// 我们的测试类的包要和上面的启动类属于包的同一层级 即都在 com.atcode.redis 下</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;jedis&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;testJedis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> jedis <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;jedis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;jedis = &quot;</span> <span class="token operator">+</span> jedis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//jedis = testJedis</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务锁机制" tabindex="-1"><a class="header-anchor" href="#事务锁机制" aria-hidden="true">#</a> 事务锁机制</h2><blockquote><p>Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。Redis事务的主要作用就是串联多个命令防止别的命令插队。</p></blockquote><ul><li><p>事务控制命令</p><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td>multi</td><td>开始组队</td></tr><tr><td>exec</td><td>执行队列中的命令</td></tr><tr><td>discard</td><td>取消组队</td></tr></tbody></table><blockquote><p>从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。组队的过程中可以通过discard取消组队</p></blockquote></li><li><p>分为三种情况:</p><ol><li>组队成功,提交成功 (命令没有问题 直接执行成功)</li><li>组队报错,提交失败：提交失败组队中<strong>某个命令出现了报告错误</strong>，执行时整个的所有队列<strong>都会被取消</strong></li><li>组队成功,提交时有成功有失败。如果<strong>执行阶段某个命令报出了错误</strong>，则只有报错的命令不会被执行，其他的命令都会执行，<strong>不会回滚</strong>。</li></ol></li></ul><h3 id="事务锁案例" tabindex="-1"><a class="header-anchor" href="#事务锁案例" aria-hidden="true">#</a> 事务锁案例</h3><h4 id="悲观锁" tabindex="-1"><a class="header-anchor" href="#悲观锁" aria-hidden="true">#</a> 悲观锁</h4><blockquote><p>悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。</p></blockquote><h4 id="乐观锁" tabindex="-1"><a class="header-anchor" href="#乐观锁" aria-hidden="true">#</a> 乐观锁</h4><blockquote><p>乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis就是利用这种check-and-set机制实现事务的。</p></blockquote><h4 id="redis实现监视key" tabindex="-1"><a class="header-anchor" href="#redis实现监视key" aria-hidden="true">#</a> Redis实现监视key</h4><blockquote><p>在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</p></blockquote><blockquote><p>取消 WATCH 命令对所有 key 的监视。如果在执行 WATCH 命令之后，EXEC 命令或DISCARD 命令先被执行了的话，那么就不需要再执行UNWATCH 了。</p></blockquote><p>例如下面的例子，我们在左边先输入一个简单的事务，再对数据进行操作之后我们先不输入执行的命令，然后再另外的窗口对此数据进行修改，然后在左边的窗口进行执行的命令，那么可以看到最后事务会执行失败。<br> 这就是先认为别人不会修改命令，然后在最后对此数据进行更新时会判断别人是否对该数据进行了修改，利用到了watch这个命令<br><img src="https://cdn.jsdelivr.net/gh/wxhcoding/myblog-img/redis/redis-20230904182415.png" alt="redis-20230904182415"></p><h4 id="三个特性" tabindex="-1"><a class="header-anchor" href="#三个特性" aria-hidden="true">#</a> 三个特性</h4><ul><li>单独的隔离操作 <ul><li>事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li></ul></li><li>没有隔离级别的概念 <ul><li>队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</li></ul></li><li>事务不保证原子性（单条命令还是原子性） <ul><li>事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚</li></ul></li></ul><h3 id="lua脚本" tabindex="-1"><a class="header-anchor" href="#lua脚本" aria-hidden="true">#</a> Lua脚本</h3><blockquote><p>Lua 是一个小巧的<a href="http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener noreferrer">脚本语言<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。<br> 将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。<br> LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。但是注意redis的lua脚本功能，只有在Redis 2.6以上的版本才可以使用。利用lua脚本淘汰用户，解决超卖问题。redis 2.6版本以后，通过lua脚本解决争抢问题，实际上是redis利用其单线程的特性，用任务队列的方式解决多任务并发问题。</p></blockquote><p>下面我们实现这样一个场景，首先获取一个key的value，判断该key的value是否和某个值相等，如果相等则进行修改，如果不等或者不存在则不修改，并且让这一个流程是一个完整的流程。<br> 也就是说必须在一个 multi 中，因为不能进行if的判断所以我们需要引入Lua脚本</p><ul><li><p>首先创建一个Maven项目并导入相关依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--首先引入springboot的父工程--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--导入web的相关依赖--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--导入测试类的相关依赖--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--导入连接redis的依赖--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置文件<code>application.properties</code>编写</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 这里我们默认使用自带的工具 lettuce 来连接redis 只需配置ip和端口号即可</span>
<span class="token key attr-name">spring.data.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.206.100</span>
<span class="token key attr-name">spring.data.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>lua脚本的创建<code>test.lua</code> 和配置文件一样也要放在resource目录下</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>local current = redis.call(&#39;GET&#39;, KEYS[1])
if current == ARGV[1]
  then redis.call(&#39;SET&#39;, KEYS[1], ARGV[2])
  return true
end
return false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面 redis.call 说明是要调用redis中的get命令 并要获取 KEYS[1] 对应的数据<br> ARGV[1] 是判断我们获取到的值是否和要判断的值相等 ARGV[2] 如果相等是要把原来获取的值修改为我们目标值</p></blockquote></li><li><p>创建springboot的启动类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建一个配置类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">// 简单序列化 返回我们的redisTemplate</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置键序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置简单类型值的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置默认序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 加载lua脚本 设置返回值类型</span>
    <span class="token comment">// RedisScript&lt;T&gt; 这里的泛型T 指的是我们lua脚本返回值的类型</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1.加载lua脚本</span>
        <span class="token class-name">ClassPathResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;test.lua&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.让redis的脚本对象加载该lua脚本</span>
        <span class="token keyword">return</span> <span class="token class-name">RedisScript</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建一个测试类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LuaTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> redisScript<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * redisTemplate.execute(lua脚本, key的list集合, ...args【旧值, 新值】)
     * 如果是单个参数，使用这个可以转换为单元素集合
     *      Collections.singletonList(参数);
     * 多参数
     *      List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span><span class="token punctuation">&gt;</span></span> keys = Arrays.asList(key1, key2, key3);
     */</span>
    <span class="token annotation punctuation">@Test</span> <span class="token comment">// 测试类不能有返回值</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkAndSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keyList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisScript<span class="token punctuation">,</span> keyList<span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vv1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result <span class="token operator">?</span> <span class="token string">&quot;成功&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 成功 并且redis中 k1对应的v1也改为了vv1</span>
      <span class="token doc-comment comment">/**
      * 127.0.0.1:6379&gt; get k1
      * &quot;v1&quot;
      * 127.0.0.1:6379&gt; get k1
      * &quot;vv1&quot;
      */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><div class="custom-container tip"><p class="custom-container-title">说明</p><p>首先我们启动项目，会启动springboot的启动类，然后在ioc容器中会通过配置类注入redisTemplate和redisScript，然后我们的测试类会从ioc容器中获取到这两个对象，redisTemplate会帮我们执行具体的redis命令，而redisScript对象会帮我们加载lua脚本，加载完之后会通过RedisTemplate去执行具体的操作<br> 我们通过Collections.singletonList()方法把我们的单个参数转为单元素集合，然后通过redisTemplate的execute()方法去执行，首先传入的第一个参数就是我们的redisScript对象，其中加载了我们的lua脚本文件，然后传入key的集合，后面分别传入旧值，新值</p></div><h2 id="redis的持久化" tabindex="-1"><a class="header-anchor" href="#redis的持久化" aria-hidden="true">#</a> Redis的持久化</h2><blockquote><p>我们知道Redis是一个内存型数据库,内存的特性是掉电或者程序退出则不保存数据,但是经过实测我们发现,Redis重启服务后,之前存储的数据仍然在,那么这就是通过持久化的方式实现的.<br> Redis 提供了2个不同形式的持久化方式。</p></blockquote><ul><li>RDB（Redis DataBase）定时数据快照 默认方式</li><li>AOF（Append Of File） 指令日志文件 手动开启</li></ul><h3 id="rdb持久化" tabindex="-1"><a class="header-anchor" href="#rdb持久化" aria-hidden="true">#</a> RDB持久化</h3><blockquote><p>在指定的时间间隔内将内存中的数据集快照写入磁盘,也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里.</p></blockquote><h4 id="rdb相关的配置与操作" tabindex="-1"><a class="header-anchor" href="#rdb相关的配置与操作" aria-hidden="true">#</a> RDB相关的配置与操作</h4><ul><li><p>RDB文件名配置</p><ul><li>在redis.conf中配置文件名称，默认为dump.rdb</li><li><code>dbfilename dump.rdb</code></li></ul></li><li><p>RDB文件位置配置</p><ul><li>rdb文件的保存路径，可以进行修改。默认为Redis启动时命令行所在的目录下</li><li>这样如果每次执行redis启动时所在的目录不一样，那么我们备份的文件所在的位置也就不一样则读取不到上一次备份的数据</li><li>我们修改为在一个固定的位置 <code>dir /root/myredis/</code></li></ul></li><li><p>RDB手动执行快照命令</p><ul><li>save ：使用主进程进行持久化指令,save时只管保存，其它不管，全部阻塞。手动保存。【不建议】</li><li>bgsave：Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。 <ul><li>可以通过lastsave 命令获取最后一次成功执行快照的时间[获取到的为时间戳]</li></ul></li><li>flushall命令 <ul><li>执行flushall命令，也会产生dump.rdb文件，但里面是空的，【无意义】</li></ul></li><li>shutdown命令 <ul><li>shutdown命令在关系服务的时候也会进行自动的持久化</li><li>如果还在redis-cli的界面中 可以选择 shutdown [SAVE|NOSAVE]</li><li>如果退出连接的客户端 执行的是 redis-cli shutdown 默认走的就是 save</li></ul></li></ul></li><li><p>RDB自动执行快照策略</p><div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code># Unless specified otherwise<span class="token punctuation">,</span> by default Redis will save the DB<span class="token punctuation">:</span>
#   <span class="token operator">*</span> After <span class="token number">3600</span> seconds <span class="token punctuation">(</span>an hour<span class="token punctuation">)</span> <span class="token keyword">if</span> at least <span class="token number">1</span> <span class="token keyword">change</span> was performed
#   <span class="token operator">*</span> After <span class="token number">300</span> seconds <span class="token punctuation">(</span><span class="token number">5</span> minutes<span class="token punctuation">)</span> <span class="token keyword">if</span> at least <span class="token number">100</span> <span class="token keyword">changes</span> were performed
#   <span class="token operator">*</span> After <span class="token number">60</span> seconds <span class="token keyword">if</span> at least <span class="token number">10000</span> <span class="token keyword">changes</span> were performed
#
# You can <span class="token keyword">set</span> these explicitly by uncommenting the following line<span class="token operator">.</span>
#
# save <span class="token number">3600</span> <span class="token number">1</span> <span class="token number">300</span> <span class="token number">100</span> <span class="token number">60</span> <span class="token number">10000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这里默认的自动方式就是上面的三种方式 如果在规定的时间内达到了改变的条件数那么就会立即进行备份</li><li>格式：save 秒钟 写操作次数 RDB是整个内存的压缩过的Snapshot，RDB的数据结构，可以配置复合的快照触发条件， 默认是1分钟至少1万个key发生变化，或5分钟至少100个key发生变化，或1个小时至少1个key发生变化。</li></ul></li><li><p>RDB备份异常策略(stop-writes-on-bgsave-error)</p><ul><li>当Redis无法写入磁盘的话，直接关掉Redis的写操作。推荐yes.</li></ul></li><li><p>RDB文件压缩配置(rdbcompression)</p><ul><li>对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能。推荐yes.</li></ul></li><li><p>RDB文件检查完整性配置(rdbchecksum)</p><ul><li>在存储快照后，还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能.推荐yes.</li></ul></li><li><p>RDB手动备份操作</p><ul><li>查询rdb文件的目录 将 *.rdb的文件拷贝到别的地方</li><li>rdb的恢复 <ul><li>关闭Redis</li><li>先把备份的文件拷贝到工作目录下 cp dump2.rdb dump.rdb</li><li>启动Redis, 备份数据会直接加载</li></ul></li></ul></li></ul><h4 id="rdb持久化流程" tabindex="-1"><a class="header-anchor" href="#rdb持久化流程" aria-hidden="true">#</a> RDB持久化流程</h4><p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件<strong>替换</strong>上次持久化好的文件。 整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p><blockquote><ul><li>Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程</li><li>在Linux程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后多会exec系统调用，出于效率考虑，Linux中引入了“写时复制技术”</li><li>一般情况父进程和子进程会共用同一段物理内存，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。</li></ul></blockquote><h4 id="rdb的优势和劣势" tabindex="-1"><a class="header-anchor" href="#rdb的优势和劣势" aria-hidden="true">#</a> RDB的优势和劣势</h4><ul><li>优势 <ul><li>适合大规模的数据恢复</li><li>对数据完整性和一致性要求不高更适合使用</li><li><strong>节省磁盘空间</strong></li><li><strong>恢复速度快</strong></li></ul></li><li>劣势 <ul><li>Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑</li><li>虽然Redis在fork时使用了<strong>写时拷贝技术</strong>,但是如果数据庞大时还是比较消耗性能。</li><li>在备份周期在一定间隔时间做一次备份，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。</li></ul></li></ul><h3 id="aof持久化" tabindex="-1"><a class="header-anchor" href="#aof持久化" aria-hidden="true">#</a> AOF持久化</h3><blockquote><p>Append Only File 以日志的形式来记录每个<strong>写操作（增量保存）</strong>，将Redis执行过的所有<strong>写指令记录下来(读操作不记录)</strong>， 只许<strong>追加文件</strong>但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容<strong>将写指令从前到后执行一次</strong>以完成数据的恢复工作</p></blockquote><h4 id="aof相关配置与操作" tabindex="-1"><a class="header-anchor" href="#aof相关配置与操作" aria-hidden="true">#</a> AOF相关配置与操作</h4><ul><li><p>AOF文件名配置</p><ul><li>可以在redis.conf中配置文件名称，默认为 appendonly.aof</li><li><code>appendfilename &quot;appendonly.aof&quot;</code></li></ul></li><li><p>AOF文件位置路径</p><ul><li>Redis6中，AOF文件的保存路径，同RDB的路径一致。</li><li>Redis7有变化: <ul><li>base：基本文件 其中保存的数据是如果之前使用过RDB进行过备份，它会默认拿到RDB备份的数据作为原始数据</li><li>incr：增量文件 每次增量的写操作</li><li>manifest：清单文件 其中说明了我们的base文件和incr文件</li></ul></li></ul></li><li><p>AOF开启-修复-恢复操作</p><ul><li>正常恢复数据 修改默认的appendonly no，改为yes,开启AOF方式 <code>appendonly yes</code></li><li>异常恢复数据 <ul><li>这里有一个情况是 因为我们的增量的写操作都保存在了incr文件中，如果我们对其中的内容进行了修改，如果说修改涉及到了文件大小的改变那么后面启动redis时会直接进行报错不能启动，但是如果我们的修改并没有使文件大小进行改变，那么会启动成功，并且我们修改的增量文件的内容还可以生效</li><li>但是如果进行了修改并且文件大小进行了改变，不能启动也不知道哪里进行了修改，这时可以使用命令进行修复<code>redis-check-aof --fix appendonly.aof.1.incr.aof</code></li><li>但是这个命令会在修改的地方往后全部进行备份的删除，只会保留修改位置的上方的备份数据</li><li><strong>注意</strong>: 这里只是作为了解，并不会真正去这样操作去修改备份文件的数据，只作为这种机制的了解</li></ul></li></ul></li><li><p>AOF同步频率设置</p><ul><li>appendfsync always <ul><li>始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好</li></ul></li><li>appendfsync everysec <ul><li>每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。</li></ul></li><li>appendfsync no <ul><li>redis不主动进行同步，把同步时机交给操作系统。</li></ul></li></ul></li><li><p>AOF压缩配置</p><ul><li><p>AOF采用文件追加方式，文件会越来越大为避免出现此种情况，新增了重写机制, 当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩， 只保留可以恢复数据的最小指令集.可以使用命令<code>bgrewriteaof</code></p></li><li><p>重写</p><ul><li>AOF文件持续增长而过大时，会fork出一条新进程来将文件重写(也是先写临时文件最后再rename)，redis4.0版本后的重写，实质上就是把rdb的快照，以二级制的形式附在新的aof头部，作为已有的历史数据，替换掉原来的流水账操作</li><li>no-appendfsync-on-rewrite 设置重写策略</li><li>如果 <code>no-appendfsync-on-rewrite=yes</code> ,不写入aof文件只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高性能）</li><li>如果 <code>no-appendfsync-on-rewrite=no</code>, 还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）</li></ul></li><li><p>触发重写</p><ul><li>Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发,重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定Redis要满足一定条件才会进行重写。</li><li>auto-aof-rewrite-percentage 设置重写基准值 <ul><li>文件达到100%时开始重写（文件是原来重写后文件的2倍时触发）</li></ul></li><li>auto-aof-rewrite-min-size 设置重写基准值 <ul><li>最小文件64MB。达到这个值开始重写。</li></ul></li><li>例如：文件达到70MB开始重写，降到50MB，下次100MB开始重写。</li><li>系统载入时或者上次重写完毕时，Redis会记录此时AOF大小，设为base_size,如果Redis的AOF当前大小&gt;= base_size +base_size*100% (默认)且当前大小&gt;=64mb(默认)的情况下，Redis会对AOF进行重写。</li></ul></li></ul></li></ul><h4 id="aof持久化流程" tabindex="-1"><a class="header-anchor" href="#aof持久化流程" aria-hidden="true">#</a> AOF持久化流程</h4><ol><li>客户端的请求写命令会被append追加到AOF缓冲区内；</li><li>AOF缓冲区根据AOF持久化策略[always,everysec,no]将操作sync同步到磁盘的AOF文件中；</li><li>AOF文件大小超过重写策略或手动重写时，会对AOF文件rewrite重写，压缩AOF文件容量；</li><li>Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的；</li></ol><h4 id="aof的优势和劣势" tabindex="-1"><a class="header-anchor" href="#aof的优势和劣势" aria-hidden="true">#</a> AOF的优势和劣势</h4><ul><li><p>优势</p><ul><li>备份机制更稳健，丢失数据概率更低。</li><li>可读的日志文本，通过操作AOF文件，可以处理误操作。</li></ul></li><li><p>劣势</p><ul><li>比起RDB占用更多的磁盘空间。</li><li>恢复备份速度要慢。</li><li>每次读写都同步的话，有一定的性能压力。</li><li>存在个别Bug，造成无法恢复。</li></ul></li></ul><h3 id="rdb和aof" tabindex="-1"><a class="header-anchor" href="#rdb和aof" aria-hidden="true">#</a> RDB和AOF</h3><div class="custom-container tip"><p class="custom-container-title">RDB和AOF的选择</p><p>并没有具体的选择，根据场景需要进行选择</p><ul><li>官方推荐两个都启用。</li><li>如果对数据不敏感，可以选单独用RDB。</li><li>不建议单独用 AOF，因为可能会出现Bug。</li><li>如果只是做纯内存缓存，可以都不用。</li><li>AOF和RDB如果同时开启,系统默认取AOF中的持久化数据</li></ul></div><div class="custom-container tip"><p class="custom-container-title">官网建议</p><ul><li><p>RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储</p></li><li><p>AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾.</p></li><li><p>Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大</p></li><li><p>只做缓存：如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.</p></li><li><p>同时开启两种持久化方式</p></li><li><p>在这种情况下,当redis重启的时候会优先载入AOF文件来恢复原始的数据, 因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.</p></li><li><p>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？</p></li><li><p>建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)， 快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段。</p></li><li><p>性能建议</p><ul><li><p>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。</p></li><li><p>如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。</p></li><li><p>代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。</p></li><li><p>只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上。</p></li><li><p>默认超过原大小100%大小时重写可以改到适当的数值。</p></li></ul></li></ul></div><h2 id="redis主从复制" tabindex="-1"><a class="header-anchor" href="#redis主从复制" aria-hidden="true">#</a> Redis主从复制</h2><blockquote><p>主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制，Master以写为主，Slave以读为主</p></blockquote><h3 id="具体操作" tabindex="-1"><a class="header-anchor" href="#具体操作" aria-hidden="true">#</a> 具体操作</h3><ul><li><p>实现思路</p><ul><li>一个redis服务作为主机主要负责写操作</li><li>两个redis服务作为从机主要负责读操作</li><li>从机自动从主机同步数据下来</li><li>从机主动找主机，而主机不会主动找从机</li><li>正常来说主机和从机应该在不同的IP上开启redis服务，我们为了快速模拟，可以在一台机器上模拟出三个redis服务即可</li></ul></li><li><p>一台机器上启动多个redis服务</p><ul><li>使用redis-server启动服务时,要以来redis.conf配置文件.那么我们可以准备三个redis.conf文件,用来配置三个不同的服务,启动三次分别以来三个不同的服务即可</li><li>如果原来开启了AOF持久化的方式 需要关掉AOF</li><li>新建redis6379.conf<div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code># 引入共同的配置
<span class="token builtin">include</span> <span class="token operator">/</span>root<span class="token operator">/</span>myredis<span class="token operator">/</span>redis<span class="token operator">.</span><span class="token keyword">conf</span>
# 使用独立的进程文件
pidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis_6379<span class="token operator">.</span>pid
# 设置当前服务的端口号
port <span class="token number">6379</span>
# 使用独立的RDB持久化文件  暂时不适用AOF持久化
dbfilename dump6379<span class="token operator">.</span>rdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>复制上面的文件两份 分别命名为 <code>redis6380.conf</code> <code>redis6381.conf</code></li><li>然后 对它们进行编辑 批量替换 <code>:%s/6379/6380</code> <code>:%s/6379/6381</code></li><li>启动三个服务<div class="language-shellsession line-numbers-mode" data-ext="shellsession"><pre class="language-shellsession"><code><span class="token command"><span class="token info punctuation"><span class="token user">[root@jhw myredis]</span></span><span class="token shell-symbol important">#</span> <span class="token bash language-bash">redis-server redis6379.conf</span></span>
<span class="token command"><span class="token info punctuation"><span class="token user">[root@jhw myredis]</span></span><span class="token shell-symbol important">#</span> <span class="token bash language-bash">redis-server redis6380.conf</span></span>
<span class="token command"><span class="token info punctuation"><span class="token user">[root@jhw myredis]</span></span><span class="token shell-symbol important">#</span> <span class="token bash language-bash">redis-server redis6381.conf</span></span>
<span class="token command"><span class="token info punctuation"><span class="token user">[root@jhw myredis]</span></span><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> redis</span></span>
<span class="token output">root      36841      1  0 23:32 ?        00:00:00 redis-server *:6379
root      36847      1  0 23:32 ?        00:00:00 redis-server *:6380
root      36854      1  0 23:32 ?        00:00:00 redis-server *:6381
root      36860  33297  0 23:32 pts/1    00:00:00 grep --color=auto redis
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>输入 <code>redis-cli -p 6379</code> <code>redis-cli -p 6380</code> <code>redis-cli -p 6381</code> 分别在三个窗口连接三个服务</li><li>执行 <code>info replication</code>查看信息 可以看到现在三个服务还没有任何联系 <img src="https://cdn.jsdelivr.net/gh/wxhcoding/myblog-img/redis/redis-20230904233908.png" alt="redis-20230904233908"></li><li>配置主从机器 <ul><li>配从不配主,是让从机主动去找主机</li><li>在6380 和6381的机器上执行如下命令<div class="language-shellsession line-numbers-mode" data-ext="shellsession"><pre class="language-shellsession"><code><span class="token output">slaveof 192.168.206.100 6379
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><img src="https://cdn.jsdelivr.net/gh/wxhcoding/myblog-img/redis/redis-20230904234714.png" alt="redis-20230904234714"></li><li>测试主从读写操作<div class="language-shellsession line-numbers-mode" data-ext="shellsession"><pre class="language-shellsession"><code><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">主机<span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">)</span>可以进行读和写<span class="token punctuation">(</span>但主要负责写操作<span class="token punctuation">)</span></span></span>
<span class="token output">127.0.0.1:6379&gt; set k1 v1
OK
127.0.0.1:6379&gt; get k1
&quot;v1&quot;

</span><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">从机<span class="token punctuation">(</span><span class="token number">6380</span><span class="token punctuation">)</span>只可以进行读</span></span>
<span class="token output">127.0.0.1:6380&gt; get k1
&quot;v1&quot;
127.0.0.1:6380&gt; set k2 v2
(error) READONLY You can&#39;t write against a read only replica.
</span><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">从机<span class="token punctuation">(</span><span class="token number">6381</span><span class="token punctuation">)</span>只可以进行读</span></span>
<span class="token output">127.0.0.1:6381&gt; get k1
&quot;v1&quot;
127.0.0.1:6381&gt; set k3 v3
(error) READONLY You can&#39;t write against a read only replica.
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>主机宕机,重启即可恢复主从状态,无需其他操作 这时从机还是从机从机显示主机的状态为down 主机重启之后还是会显示原来的两个从机</p></li><li><p>从机宕机,重启后需要重新执行 <code>slaveof 192.168.206.100 6379</code> 才能恢复 从机宕机之后主机不再显示从机的状态</p></li><li><p>从机可以在配置文件中写入<code>slaveof 192.168.206.100 6379</code> ,这样重启无需手动输入<code>slaveof 192.168.206.100 6379</code>就可以恢复从机状态</p></li></ul><h3 id="主从复制原理" tabindex="-1"><a class="header-anchor" href="#主从复制原理" aria-hidden="true">#</a> 主从复制原理</h3><ul><li>Slave启动成功连接到master后会发送一个sync命令</li><li>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</li><li>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</li><li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li><li>但是只要是重新连接master,也就是从机宕机，宕机之后会丢失数据，所以一次完全同步(全量复制)将被自动执行</li><li>从机挂掉之后数据也会丢失所以再次连接主机时会进行全量复制</li></ul><h3 id="主从复制三种模式" tabindex="-1"><a class="header-anchor" href="#主从复制三种模式" aria-hidden="true">#</a> 主从复制三种模式</h3><div class="custom-container tip"><p class="custom-container-title">一主二仆</p></div><blockquote><p>切入点问题,slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？</p></blockquote><p>刚进来的从机，所以需要从头开始复制<br> 从k4进来说明也没有之前的数据，所以也需要复制k1,k2,k3的数据</p><blockquote><p>从机是否可以写？set可否？</p></blockquote><p>从机不可以写，即不可以set</p><blockquote><p>主机shutdown后情况如何？从机是上位还是原地待命？</p></blockquote><p>从机会原地待命</p><blockquote><p>主机又回来了后，主机新增记录，从机还能否顺利复制？</p></blockquote><p>可以，并且进行的是增量复制</p><blockquote><p>其中一台从机down后情况如何？依照原有它能跟上大部队吗(还会自动变为从机吗?)？</p></blockquote><p>不会自动变为从机，需要手动配置</p><div class="custom-container tip"><p class="custom-container-title">薪火相传</p></div><p>上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master, 可以有效减轻master的写压力,去中心化降低风险</p><p>用 <code>slaveof ip地址 port端口号</code> 来建立主从之间的联系</p><p>​中途变更转向:会清除之前的数据，重新建立拷贝最新的,风险是一旦某个slave宕机，后面的slave都没法备份,主机挂了，从机还是从机，无法写数据了</p><div class="custom-container tip"><p class="custom-container-title">反客为主</p></div><p>当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。</p><p>用 <code>slaveof no one </code>将从机变为主机。</p><p><strong>注意</strong>:</p><ul><li><p>这种模式一定要在薪火相传的链条模式下，主机如果挂掉，可以把主机相连接的下一个从机使用<code>slaveof no one</code>变成一个新的主机，这样这个新的主机后面还可以跟一个从机，从而保证了之前的主机挂掉，这时可以有新的主机也还有从机，保证既可以读也可以写。</p></li><li><p>但是之前挂掉的主机如果再恢复回来，那它还是一个新的主机和原来没有任何联系，这时还需要使用 <code>slaveof 主机的ip 主机的端口号</code> 变为新的主机的一个从机(如果不变为新的主机的从机那这时的系统会有两个主机，在进行写操作时会出现冲突导致在不同的主机进行写而进行读操作时可以读到的数据不一样)</p></li></ul><h3 id="哨兵模式" tabindex="-1"><a class="header-anchor" href="#哨兵模式" aria-hidden="true">#</a> 哨兵模式</h3><div class="custom-container tip"><p class="custom-container-title">简介</p><p>反客为主的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库<br> 是通过更改配置文件完成的这些操作</p></div><div class="custom-container tip"><p class="custom-container-title">操作演示</p></div><ol><li>首先开启三个redis服务,并设置简单的一主二仆(这里只展示命令 具体的操作可以看上方的设置步骤)</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6379.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6380.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6381.conf</span>

<span class="token comment"># 把两个从机连接到主机</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> slaveof <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
OK
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> slaveof <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
OK
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>为哨兵模式准备配置文件</p><ul><li>在/root/myredis 目录下新建sentinel.conf 配置文件中放入如下内容</li></ul><div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code>sentinel monitor mymaster <span class="token number">192.168</span><span class="token operator">.</span><span class="token number">206.100</span> <span class="token number">6379</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>其中mymaster为监控对象起的服务器名称，后面跟的是我们的ip地址， 1 为至少有多少个哨兵同意迁移的数量。</li></ul></li><li><p>启动哨兵</p><ul><li>运行/usr/local/bin 下 redis-sentinel 命令,执行/root/myredis/sentinel.conf配置文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-sentinel sentinel.conf </span>

<span class="token comment"># 启动后显示的部分信息</span>
<span class="token comment"># 显示了主机以及从机的信息</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:35:45.865 <span class="token comment"># +monitor master mymaster 192.168.206.100 6379 quorum 1</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:35:45.866 * +slave slave <span class="token number">192.168</span>.206.100:6380 <span class="token number">192.168</span>.206.100 <span class="token number">6380</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:35:45.867 * Sentinel new configuration saved on disk
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:35:45.868 * +slave slave <span class="token number">192.168</span>.206.100:6381 <span class="token number">192.168</span>.206.100 <span class="token number">6381</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:35:45.869 * Sentinel new configuration saved on disk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>主机宕机演示</p><ul><li>现在对 6379 的主机 shutdown</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 哨兵会监视到对应的信息 并选择了 6381 作为新的主机 然后把 6379 6380 作为自己的从机</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.255 <span class="token comment"># +sdown master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.255 <span class="token comment"># +odown master mymaster 192.168.206.100 6379 #quorum 1/1</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.255 <span class="token comment"># +new-epoch 1</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.255 <span class="token comment"># +try-failover master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.267 * Sentinel new configuration saved on disk
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.267 <span class="token comment"># +vote-for-leader c7d4202ae0634172e2ff45736c9f2a5986566eff 1</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.267 <span class="token comment"># +elected-leader master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.267 <span class="token comment"># +failover-state-select-slave master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.359 <span class="token comment"># +selected-slave slave 192.168.206.100:6381 192.168.206.100 6381 @ mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.359 * +failover-state-send-slaveof-noone slave <span class="token number">192.168</span>.206.100:6381 <span class="token number">192.168</span>.206.100 <span class="token number">6381</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.426 * +failover-state-wait-promotion slave <span class="token number">192.168</span>.206.100:6381 <span class="token number">192.168</span>.206.100 <span class="token number">6381</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.430 * Sentinel new configuration saved on disk
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.430 <span class="token comment"># +promoted-slave slave 192.168.206.100:6381 192.168.206.100 6381 @ mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.430 <span class="token comment"># +failover-state-reconf-slaves master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:55.489 * +slave-reconf-sent slave <span class="token number">192.168</span>.206.100:6380 <span class="token number">192.168</span>.206.100 <span class="token number">6380</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.447 * +slave-reconf-inprog slave <span class="token number">192.168</span>.206.100:6380 <span class="token number">192.168</span>.206.100 <span class="token number">6380</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.447 * +slave-reconf-done slave <span class="token number">192.168</span>.206.100:6380 <span class="token number">192.168</span>.206.100 <span class="token number">6380</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.536 <span class="token comment"># +failover-end master mymaster 192.168.206.100 6379</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.536 <span class="token comment"># +switch-master mymaster 192.168.206.100 6379 192.168.206.100 6381</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.537 * +slave slave <span class="token number">192.168</span>.206.100:6380 <span class="token number">192.168</span>.206.100 <span class="token number">6380</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6381</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.537 * +slave slave <span class="token number">192.168</span>.206.100:6379 <span class="token number">192.168</span>.206.100 <span class="token number">6379</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6381</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:46:56.543 * Sentinel new configuration saved on disk
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这时再次启动 6379 的redis服务</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 会在哨兵中看到 已经作为了 6381 的从机</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:47:26.559 <span class="token comment"># +sdown slave 192.168.206.100:6379 192.168.206.100 6379 @ mymaster 192.168.206.100 6381</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:53:06.020 <span class="token comment"># -sdown slave 192.168.206.100:6379 192.168.206.100 6379 @ mymaster 192.168.206.100 6381</span>
<span class="token number">38449</span>:X <span class="token number">10</span> Sep <span class="token number">2023</span> <span class="token number">11</span>:53:15.957 * +convert-to-slave slave <span class="token number">192.168</span>.206.100:6379 <span class="token number">192.168</span>.206.100 <span class="token number">6379</span> @ mymaster <span class="token number">192.168</span>.206.100 <span class="token number">6381</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><div class="custom-container tip"><p class="custom-container-title">说明</p></div><ul><li><p>复制延时</p><ul><li><p>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</p></li><li><p>所以并不是从机越多越好，从机越多复制延时的问题会更严重，因为从机一多就会导致复制的压力也越大</p></li></ul></li><li><p>故障恢复</p><blockquote><p>优先级在redis.conf中默认：replica-priority 100，值越小优先级越高<br> 偏移量是指获得原主机数据最全的<br> 每个redis实例启动后都会随机生成一个40位的runid</p></blockquote><ul><li>新主登基 <ul><li>从下线的主服务的从服务中选择一个作为新的主机，主要有三个选择条件，分别为 <ul><li>优先选择优先级靠前的</li><li>选择偏移量最大的</li><li>选择runid最小的一个从服务</li></ul></li></ul></li><li>群仆俯首 <ul><li>挑选出新的主服务后，sentinel向原来的主服务的从服务发送 slaveof 新的主服务 的命令，并复制新的master</li></ul></li><li>旧主俯首 <ul><li>当已下线的服务重新上线时，sentinel会向其发送slaveof命令，称为新的主服务的从服务</li></ul></li></ul></li></ul><h2 id="redis集群" tabindex="-1"><a class="header-anchor" href="#redis集群" aria-hidden="true">#</a> Redis集群</h2><div class="custom-container tip"><p class="custom-container-title">简介</p></div><h3 id="集群的搭建" tabindex="-1"><a class="header-anchor" href="#集群的搭建" aria-hidden="true">#</a> 集群的搭建</h3><ul><li>首先把全部的redis的服务停止</li><li>把之前生成的rdb aof数据备份文件删除 <ul><li><code>rm -rf d*</code></li></ul></li><li>哨兵模式会修改我们的配置文件，把添加的内容删除，改为之前我们的配置文件 <ul><li>把类似于下面的内容删除(这里以redis6379.conf示例,其他配置文件都要删除下面的内容)</li></ul><div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code># Generated by CONFIG REWRITE
latency<span class="token operator">-</span>tracking<span class="token operator">-</span>info<span class="token operator">-</span>percentiles <span class="token number">50</span> <span class="token number">99</span> <span class="token number">99.9</span>
replicaof <span class="token number">192.168</span><span class="token operator">.</span><span class="token number">206.100</span> <span class="token number">6381</span>
protected<span class="token operator">-</span><span class="token keyword">mode</span> no
save <span class="token number">3600</span> <span class="token number">1</span>
save <span class="token number">300</span> <span class="token number">100</span>
save <span class="token number">60</span> <span class="token number">10000</span>
<span class="token builtin">dir</span> <span class="token string">&quot;/root/myredis&quot;</span>
daemonize yes
user default <span class="token keyword">on</span> nopass ~<span class="token operator">*</span> &amp;<span class="token operator">*</span> <span class="token operator">+</span>@<span class="token keyword">all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>这里我们需要六个redis的配置文件即六个redis服务，三主三从的模式</li></ul><div class="custom-container tip"><p class="custom-container-title">配置文件</p></div><div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code># 引入共同的配置
<span class="token builtin">include</span> <span class="token operator">/</span>root<span class="token operator">/</span>myredis<span class="token operator">/</span>redis<span class="token operator">.</span><span class="token keyword">conf</span>
# 使用独立的进程文件
pidfile <span class="token string">&quot;/var/run/redis_6379.pid&quot;</span>
# 设置当前服务的端口号
port <span class="token number">6379</span>
# 使用独立的RDB持久化文件  暂时不适用AOF持久化
dbfilename <span class="token string">&quot;dump6379.rdb&quot;</span>
# 开启集群
cluster<span class="token operator">-</span>enabled yes
# 设置集群使用的结点文件名
cluster<span class="token operator">-</span>config<span class="token operator">-</span><span class="token keyword">file</span> nodes<span class="token operator">-</span><span class="token number">6379</span><span class="token operator">.</span><span class="token keyword">conf</span>
# 设置结点失联时间
cluster<span class="token operator">-</span>node<span class="token operator">-</span><span class="token builtin">timeout</span> <span class="token number">15000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建类似的六个文件分别为 <code>redis6379.conf</code> <code>redis6380.conf</code> <code>redis6381.conf</code> <code>redis6389.conf</code> <code>redis6390.conf</code> <code>redis6391.conf</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># cp redis6379.conf redis6380.conf</span>
cp：是否覆盖<span class="token string">&quot;redis6380.conf&quot;</span>？ y
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># cp redis6379.conf redis6381.conf</span>
cp：是否覆盖<span class="token string">&quot;redis6381.conf&quot;</span>？ y
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># cp redis6379.conf redis6389.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># cp redis6379.conf redis6390.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># cp redis6379.conf redis6391.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分别修改其中的文件 把文件中的6379端口号分别改为配置文件对应的端口号</p><div class="language-vim line-numbers-mode" data-ext="vim"><pre class="language-vim"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span># <span class="token keyword">vim</span> redis6380<span class="token operator">.</span><span class="token keyword">conf</span> 
<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6380</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span># <span class="token keyword">vim</span> redis6381<span class="token operator">.</span><span class="token keyword">conf</span> 
<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6381</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span># <span class="token keyword">vim</span> redis6389<span class="token operator">.</span><span class="token keyword">conf</span> 
<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6389</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span># <span class="token keyword">vim</span> redis6390<span class="token operator">.</span><span class="token keyword">conf</span> 
<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6390</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span># <span class="token keyword">vim</span> redis6391<span class="token operator">.</span><span class="token keyword">conf</span> 
<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6391</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">启动服务</p></div><p>启动六个服务，确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6379.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6380.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6381.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6389.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6390.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6391.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep redis</span>
root      <span class="token number">39253</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6379 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39259</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6380 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39265</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6381 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39271</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6389 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39277</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6390 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39283</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:45 ?        00:00:00 redis-server *:6391 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">39289</span>  <span class="token number">37916</span>  <span class="token number">0</span> <span class="token number">12</span>:45 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis

<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># ll</span>
总用量 <span class="token number">160</span>
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6379.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6380.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6381.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6389.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6390.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">114</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:45 nodes-6391.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:36 redis6379.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:40 redis6380.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:42 redis6381.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:42 redis6389.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:42 redis6390.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">419</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">12</span>:42 redis6391.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">106559</span> <span class="token number">9</span>月   <span class="token number">4</span> <span class="token number">19</span>:54 redis.conf
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">464</span> <span class="token number">9</span>月  <span class="token number">10</span> <span class="token number">11</span>:46 sentinel.conf
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">将六个服务合并为一个集群</p></div><blockquote><p><code>redis-cli --cluster create --cluster-replicas 1 192.168.206.100:6379 192.168.206.100:6380 192.168.206.100:6381 192.168.206.100:6389 192.168.206.100:6390 192.168.206.100:6391</code><br><strong>说明</strong>: --replicas 1 采用最简单的方式配置集群，一台主机，一台从机，六个服务正好三组。</p></blockquote><blockquote><p>下面的Master[0] Master[1] Master[2] 代表分别分配的三个槽(slots 0-16383)均摊到三个主机中<br> 下面的M S 分别代表主机 和 从机<br> 根据下面对应的id 可以看到 <strong><code>主机6379的从机是6390</code> <code>主机6380的从机是6391</code> <code>主机6381的从机是6389</code></strong></p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create --cluster-replicas 1 192.168.206.100:6379 192.168.206.100:6380 192.168.206.100:6381 192.168.206.100:6389 192.168.206.100:6390 192.168.206.100:6391</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">192.168</span>.206.100:6390 to <span class="token number">192.168</span>.206.100:6379
Adding replica <span class="token number">192.168</span>.206.100:6391 to <span class="token number">192.168</span>.206.100:6380
Adding replica <span class="token number">192.168</span>.206.100:6389 to <span class="token number">192.168</span>.206.100:6381
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: 84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389
   replicates 37c6b1faf42350688754013a9b1a484f2543cccb
S: 5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390
   replicates 84a717249d60707ae8fb7a36b888b29f038bede6
S: 51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391
   replicates 4000b17b8fc451ca91fd3b0a60254bc058a800bb
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">&#39;yes&#39;</span> to accept<span class="token punctuation">)</span>: 
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入 yes 继续</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">&#39;yes&#39;</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token builtin class-name">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.206.100:6379<span class="token punctuation">)</span>
M: 84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 37c6b1faf42350688754013a9b1a484f2543cccb
S: 51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 4000b17b8fc451ca91fd3b0a60254bc058a800bb
S: 5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 84a717249d60707ae8fb7a36b888b29f038bede6
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="集群的操作" tabindex="-1"><a class="header-anchor" href="#集群的操作" aria-hidden="true">#</a> 集群的操作</h3><div class="custom-container tip"><p class="custom-container-title">集群的登录</p></div><p>登录指令添加 <code>-c</code>代表以集群方式登录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 登录指定 添加 -c 以集群方式登录</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>

<span class="token comment"># 查看集群信息</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1694322542431</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380@16380 master - <span class="token number">0</span> <span class="token number">1694322541422</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389@16389 slave 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">0</span> <span class="token number">1694322541000</span> <span class="token number">3</span> connected
51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391@16391 slave 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">0</span> <span class="token number">1694322541000</span> <span class="token number">2</span> connected
84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1694322540000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390@16390 slave 84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">0</span> <span class="token number">1694322543440</span> <span class="token number">1</span> connected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">集群录入值</p></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 在进行读写操作时会自动帮我们切换服务 从下面的端口号可以看出一直在根据key值在自动改变不同的redis服务</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6381
OK
<span class="token comment"># k2计算出来在 449槽 所以帮我们切换到 6379</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">449</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6379
OK
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k3 v3
OK
<span class="token comment"># k4在 8455槽 切换到 6380</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k4 v4
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">8455</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6380
OK
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">set</span> k5 v5
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12582</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6381
OK
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token comment"># 取值时也会判断在哪个槽 切换到对应的服务</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get k2
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">449</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6379
<span class="token string">&quot;v2&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k3
<span class="token string">&quot;v3&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k4
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">8455</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6380
<span class="token string">&quot;v4&quot;</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get k5
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12582</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6381
<span class="token string">&quot;v5&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>不在一个slot下的键值，是不能使用mget,mset等多键操作。一般一次只存一个值</li><li>可以通过{}来定义组的概念，从而使key中{}内相同内容的键值对放到一个slot中去。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 不可直接通过mset去录入值 因为每个key值可能所在的槽是不一样的</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> mset n1 vv1 n2 vv2 n3 vv3
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> CROSSSLOT Keys <span class="token keyword">in</span> request don&#39;t <span class="token builtin class-name">hash</span> to the same slot
<span class="token comment"># 如果非要使用mget去值 可以使用{}起别名的方式 </span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> mset n1<span class="token punctuation">{</span>n<span class="token punctuation">}</span> vv1 n2<span class="token punctuation">{</span>n<span class="token punctuation">}</span> vv2 n3<span class="token punctuation">{</span>n<span class="token punctuation">}</span> vv3
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">3432</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6379
OK
<span class="token comment"># 取值时也不可以直接取值</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get n1
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get n
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token comment"># 需要和存值时一样的方式来取值</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get n1<span class="token punctuation">{</span>n<span class="token punctuation">}</span>
<span class="token string">&quot;vv1&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">集群查找值</p></div><blockquote><p>这一部分了解即可，只针对批量把值存到一个slot中的情况，一般我们不进行这样的操作，一般一次只存一个值为的就是让集群帮我们自动分摊压力</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 计算key应该保存在哪个插槽 cluster keyslot key</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot k1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12706</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5798</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot age
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">741</span>

<span class="token comment"># 计算某个插槽中保存的key的数量 cluster countkeysinslot slot的值</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6381
<span class="token string">&quot;v1&quot;</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster countkeysinslot <span class="token number">12706</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 这里是上面我们批量存储的三个值</span>
<span class="token number">192.168</span>.206.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get n1<span class="token punctuation">{</span>n<span class="token punctuation">}</span>
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">3432</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.206.100:6379
<span class="token string">&quot;vv1&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster countkeysinslot <span class="token number">3432</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>

<span class="token comment"># 返回 count个  slot槽中的键  </span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster getkeysinslot <span class="token number">3432</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;n3{n}&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster getkeysinslot <span class="token number">3432</span> <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;n3{n}&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;n2{n}&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster getkeysinslot <span class="token number">3432</span> <span class="token number">3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;n3{n}&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;n2{n}&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;n1{n}&quot;</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster getkeysinslot <span class="token number">3432</span> <span class="token number">5</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;n3{n}&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;n2{n}&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;n1{n}&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">故障恢复</p></div><ul><li><p>如果主节点下线? 从节点能否自动升为主节点? 注意：<strong>15秒超时</strong></p><ul><li>从节点可以自己升为主节点(自带哨兵模式)</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 把 6379 挂掉</span>
<span class="token number">192.168</span>.206.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">shutdown</span>
not connected<span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
<span class="token comment"># 重新连接一个服务 并查看集群的信息</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6380</span>
<span class="token comment"># 这时只是发现 连接不上了 还没有挂掉</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389@16389 slave 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">0</span> <span class="token number">1694324861516</span> <span class="token number">3</span> connected
4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380@16380 myself,master - <span class="token number">0</span> <span class="token number">1694324861000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1694324862527</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391@16391 slave 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">0</span> <span class="token number">1694324860000</span> <span class="token number">2</span> connected
5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390@16390 slave 84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">0</span> <span class="token number">1694324863537</span> <span class="token number">1</span> connected
84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379@16379 master - <span class="token number">1694324849388</span> <span class="token number">1694324846000</span> <span class="token number">1</span> disconnected <span class="token number">0</span>-5460

<span class="token comment"># 可以看到 6379 的服务显示了 fail 表明服务已经挂掉 并且可以看到之前6379的从机为6390 现在的6390已经自动升为了主节点 并占有了之前6379的 0-5460的槽</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389@16389 slave 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">0</span> <span class="token number">1694324871000</span> <span class="token number">3</span> connected
4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380@16380 myself,master - <span class="token number">0</span> <span class="token number">1694324869000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1694324871643</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391@16391 slave 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">0</span> <span class="token number">1694324871000</span> <span class="token number">2</span> connected
5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390@16390 master - <span class="token number">0</span> <span class="token number">1694324872657</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379@16379 master,fail - <span class="token number">1694324849388</span> <span class="token number">1694324846000</span> <span class="token number">1</span> disconnected
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>主节点恢复后，主从关系会如何?</p><ul><li>主节点恢复后，会变为从节点，即之前升为主节点的从节点</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 现在恢复 6379 的服务</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-server redis6379.conf</span>
<span class="token punctuation">[</span>root@jhw myredis<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>

<span class="token comment"># 查看集群信息 可以看到 6379现在成了 6390的从机</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">192.168</span>.206.100:6380@16380 master - <span class="token number">0</span> <span class="token number">1694325116000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">192.168</span>.206.100:6390@16390 master - <span class="token number">0</span> <span class="token number">1694325115000</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">192.168</span>.206.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1694325115007</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
84a717249d60707ae8fb7a36b888b29f038bede6 <span class="token number">192.168</span>.206.100:6379@16379 myself,slave 5c5bcbd89879b0e1c92f2b52340c1ebe63f03428 <span class="token number">0</span> <span class="token number">1694325115000</span> <span class="token number">7</span> connected
51dde03f608e413ee58413d85c08d1b3cfc0c1ab <span class="token number">192.168</span>.206.100:6391@16391 slave 4000b17b8fc451ca91fd3b0a60254bc058a800bb <span class="token number">0</span> <span class="token number">1694325114000</span> <span class="token number">2</span> connected
81c286d44a4bf1ea172c96318fb0ef940594c428 <span class="token number">192.168</span>.206.100:6389@16389 slave 37c6b1faf42350688754013a9b1a484f2543cccb <span class="token number">0</span> <span class="token number">1694325117027</span> <span class="token number">3</span> connected
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续?</p><ul><li>cluster-require-full-coverage 表示整个redis集群是否都可用</li><li>redis.conf中cluster-require-full-coverage 为yes 那么，整个集群都挂掉(因为必须保证全部都可用，部分挂掉则整体也挂掉)</li><li>redis.conf中cluster-require-full-coverage 为no 那么，只有该插槽数据全都不能使用(不保证全部必须都可用，部分挂掉其他的还可用)</li></ul></li></ul><p>那上面的两种配置到底选择哪一种需要根据情况来选择，也就是<strong>CAP理论</strong></p><div class="custom-container tip"><p class="custom-container-title">扩展: CAP理论</p><p><a href="https://zhuanlan.zhihu.com/p/50990721" target="_blank" rel="noopener noreferrer">轻松理解CAP理论<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h3 id="集群的利弊" tabindex="-1"><a class="header-anchor" href="#集群的利弊" aria-hidden="true">#</a> 集群的利弊</h3><div class="custom-container tip"><p class="custom-container-title">好处</p></div><ul><li>实现扩容</li><li>分摊压力</li><li>无中心配置相对简单</li></ul><div class="custom-container tip"><p class="custom-container-title">坏处</p></div><ul><li>多键操作是不被支持的</li><li>多键的Redis事务是不被支持的。lua脚本不被支持</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1515398578@qq.com">wxhcoding</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/myblog/database/sql/mysql_advanced.html" class="" aria-label="MySQL高级"><!--[--><!--]--> MySQL高级 <!--[--><!--]--></a></span><span class="next"><a href="/myblog/database/nosql/redis_basic.html" class="" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/myblog/assets/app-1lTnJ-Z-.js" defer></script>
  </body>
</html>
